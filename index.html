<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Cash</title>

<style>
:root{
  --bg:#0f0f14;--card:#1a1a26;--accent:#7c5cff;
  --danger:#ff4d4d;--ok:#22c55e;
  --text:#fff;--muted:#9a9ab3;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.app{max-width:520px;margin:auto;padding:16px}
h1{text-align:center;margin:10px 0 14px}

.hidden{display:none}

/* top buttons */
.topbar{display:flex;gap:10px;margin-bottom:12px}
.topbar button{
  flex:1;padding:12px;border-radius:14px;
  background:var(--card);color:var(--text);
  border:1px solid rgba(255,255,255,.08)
}
.topbar button.active{
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(124,92,255,.2) inset;
}

/* summary */
.row{display:flex;gap:10px;margin-bottom:12px}
.card{flex:1;background:var(--card);border-radius:14px;padding:12px}
.card .label{color:var(--muted);font-size:13px}
.card .value{color:var(--accent);font-size:20px;margin-top:6px}

/* voice */
button.primary{
  width:100%;padding:16px;border-radius:16px;
  border:none;background:var(--accent);color:#fff;font-size:18px
}
button.primary.recording{
  background:var(--danger);
  animation:pulse 1.2s infinite
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(255,77,77,.6)}
  70%{box-shadow:0 0 0 18px rgba(255,77,77,0)}
  100%{box-shadow:0 0 0 0 rgba(255,77,77,0)}
}
.status{text-align:center;color:var(--muted);margin:10px 0}

/* records */
.record{
  background:var(--card);border-radius:12px;
  padding:10px;margin:8px 0;
  display:flex;align-items:center;gap:10px
}
.icon{
  font-size:22px;width:28px;text-align:center
}
.recMain{flex:1;min-width:0}
.recTitle{font-size:15px}
.recMeta{color:var(--muted);font-size:12px;margin-top:2px}
.recRight{display:flex;align-items:center;gap:8px}
.amount{font-size:16px}
.menuBtn{
  background:transparent;border:none;color:var(--muted);
  font-size:20px;cursor:pointer
}

/* context menu */
.menu{
  position:absolute;background:var(--card);
  border:1px solid rgba(255,255,255,.1);
  border-radius:10px;overflow:hidden;
  z-index:10
}
.menu div{
  padding:10px 14px;cursor:pointer;
}
.menu div:hover{background:rgba(255,255,255,.06)}

/* chart */
.chart{
  display:flex;align-items:flex-end;
  gap:6px;height:170px;
  margin-top:14px;
  overflow-x:auto;padding-bottom:20px
}
.col{
  width:18px;border-radius:6px;
  background:rgba(124,92,255,.8);
  position:relative;cursor:pointer
}
.col.zero{background:rgba(255,255,255,.12)}
.col .sum{
  position:absolute;top:-16px;left:50%;
  transform:translateX(-50%);
  font-size:10px
}
.col .day{
  position:absolute;bottom:-18px;left:50%;
  transform:translateX(-50%);
  font-size:10px;color:var(--muted)
}

/* modal */
.modalBack{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:flex;align-items:flex-end;
  padding:14px;z-index:20
}
.modal{
  background:var(--card);
  width:100%;max-width:520px;
  margin:auto;border-radius:18px;
  padding:14px
}
.field{margin-bottom:10px}
.field label{font-size:12px;color:var(--muted)}
.field input{
  width:100%;padding:12px;border-radius:12px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.04);
  color:var(--text)
}
.modalActions{display:flex;gap:10px}
.modalActions button{
  flex:1;padding:12px;border-radius:14px;
  border:none;font-size:15px
}
.save{background:var(--ok)}
.del{background:var(--danger);color:#fff}
.cancel{background:rgba(255,255,255,.1)}
</style>
</head>

<body>
<div class="app">
  <h1>üéô Voice Cash</h1>

  <div class="topbar">
    <button id="btnDay" class="active">–¢—Ä–∞—Ç—ã –∑–∞ –¥–µ–Ω—å</button>
    <button id="btnMonth">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–µ—Å—è—Ü</button>
    <button id="btnYear">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ–¥</button>
  </div>

  <div class="row">
    <div class="card"><div class="label">–°–µ–≥–æ–¥–Ω—è</div><div class="value" id="sumToday">0</div></div>
    <div class="card"><div class="label">–ú–µ—Å—è—Ü</div><div class="value" id="sumMonth">0</div></div>
    <div class="card"><div class="label">–ì–æ–¥</div><div class="value" id="sumYear">0</div></div>
  </div>

  <button id="recBtn" class="primary">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
  <div class="status" id="status"></div>

  <div id="viewDay"></div>
  <div id="viewMonth" class="hidden">
    <div class="chart" id="monthChart"></div>
  </div>
</div>

<!-- edit modal -->
<div id="modalBack" class="modalBack hidden">
  <div class="modal">
    <div class="field">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input id="mItem">
    </div>
    <div class="field">
      <label>–°—É–º–º–∞</label>
      <input id="mAmount" type="number">
    </div>
    <div class="field">
      <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
      <input id="mCategory">
    </div>
    <div class="modalActions">
      <button class="cancel" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="del" onclick="deleteRecord()">–£–¥–∞–ª–∏—Ç—å</button>
      <button class="save" onclick="saveRecord()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
const KEY='vc-data';
let records=JSON.parse(localStorage.getItem(KEY)||'[]');

const CATEGORY_ICONS={
  '–ö–æ—Ñ–µ':'‚òï','–ï–¥–∞':'üçó','–ü—Ä–æ–¥—É–∫—Ç—ã':'üõí',
  '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç':'üöï','–°–≤—è–∑—å':'üì∂',
  '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è':'üé¨','–ó–¥–æ—Ä–æ–≤—å–µ':'üíä',
  '–î–æ–º':'üè†','–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ':'‚ùì'
};

const RULES=[
 {c:'–ö–æ—Ñ–µ',k:['–∫–æ—Ñ–µ','–ª–∞—Ç—Ç–µ','–∫–∞–ø—É—á–∏–Ω–æ']},
 {c:'–ï–¥–∞',k:['–µ–¥–∞','—Ä–µ—Å—Ç–æ—Ä–∞–Ω','—à–∞—É—Ä–º–∞','–ø–∏—Ü—Ü–∞']},
 {c:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',k:['—Ç–∞–∫—Å–∏','–º–µ—Ç—Ä–æ','–∞–≤—Ç–æ–±—É—Å']}
];
const detectCat=t=>{
 t=t.toLowerCase();
 for(const r of RULES)
  for(const k of r.k)
   if(t.includes(k)) return r.c;
 return '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
};

const $=id=>document.getElementById(id);
let editing=null,menuEl=null;

function iso(d){return d.toISOString().slice(0,10)}
const today=()=>iso(new Date());

function render(){
 let t=0,m=0,y=0;
 $('viewDay').innerHTML='';
 records.forEach(r=>{
  if(r.date===today()){
   t+=r.amount;
   const row=document.createElement('div');
   row.className='record';
   row.innerHTML=`
    <div class="icon">${CATEGORY_ICONS[r.category]||'‚ùì'}</div>
    <div class="recMain">
      <div class="recTitle">${r.item}</div>
      <div class="recMeta">${r.category}</div>
    </div>
    <div class="recRight">
      <div class="amount">${r.amount}</div>
      <button class="menuBtn">‚ãÆ</button>
    </div>`;
   row.querySelector('.menuBtn').onclick=e=>openMenu(e,r);
   $('viewDay').appendChild(row);
  }
  if(r.date.slice(0,7)===today().slice(0,7)) m+=r.amount;
  if(r.date.slice(0,4)===today().slice(0,4)) y+=r.amount;
 });
 $('sumToday').textContent=t;
 $('sumMonth').textContent=m;
 $('sumYear').textContent=y;
 renderMonth();
}

function openMenu(e,rec){
 closeMenu();
 editing=rec;
 menuEl=document.createElement('div');
 menuEl.className='menu';
 menuEl.innerHTML=`
  <div onclick="openModal()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</div>
  <div onclick="deleteRecord()">–£–¥–∞–ª–∏—Ç—å</div>`;
 document.body.appendChild(menuEl);
 const r=e.target.getBoundingClientRect();
 menuEl.style.top=(r.bottom+4)+'px';
 menuEl.style.left=(r.left-80)+'px';
 document.addEventListener('click',closeMenu,{once:true});
}

function closeMenu(){
 if(menuEl){menuEl.remove();menuEl=null;}
}

function openModal(){
 closeMenu();
 $('modalBack').classList.remove('hidden');
 $('mItem').value=editing.item;
 $('mAmount').value=editing.amount;
 $('mCategory').value=editing.category;
}
function closeModal(){
 $('modalBack').classList.add('hidden');
}
function saveRecord(){
 editing.item=$('mItem').value;
 editing.amount=+$('mAmount').value;
 editing.category=$('mCategory').value||editing.category;
 localStorage.setItem(KEY,JSON.stringify(records));
 closeModal();render();
}
function deleteRecord(){
 records=records.filter(r=>r.id!==editing.id);
 localStorage.setItem(KEY,JSON.stringify(records));
 closeModal();render();
}

function renderMonth(){
 const days={};
 records.forEach(r=>{
  if(r.date.slice(0,7)!==today().slice(0,7)) return;
  days[r.date]=(days[r.date]||0)+r.amount;
 });
 const chart=$('monthChart');
 chart.innerHTML='';
 Object.keys(days).sort().forEach(d=>{
  const col=document.createElement('div');
  col.className='col';
  col.style.height=(days[d]/5)+'px';
  col.innerHTML=`<div class="sum">${days[d]}</div><div class="day">${d.slice(8)}</div>`;
  chart.appendChild(col);
 });
}

let rec,isRec=false;
$('recBtn').onclick=()=>{
 if(isRec){rec.stop();return;}
 rec=new webkitSpeechRecognition();
 rec.lang='ru-RU';
 rec.onresult=e=>{
  const t=e.results[0][0].transcript;
  const m=t.match(/(.+)\s(\d+)/);
  if(!m) return;
  records.unshift({
   id:crypto.randomUUID(),
   item:m[1].trim(),
   amount:+m[2],
   category:detectCat(m[1]),
   date:today()
  });
  localStorage.setItem(KEY,JSON.stringify(records));
  render();
 };
 rec.start();isRec=true;
};

render();
</script>
</body>
</html>
