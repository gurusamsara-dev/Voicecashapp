<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Voice Cash</title>

<style>
:root{
  --bg:#0f0f14;--card:#1a1a26;--accent:#7c5cff;--danger:#ff4d4d;--text:#fff;--muted:#9a9ab3;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.app{max-width:520px;margin:auto;padding:16px 14px 22px}
h1{text-align:center;margin:10px 0 12px}

.hidden{display:none}

.topbar{display:flex;gap:10px;margin-bottom:12px}
.topbar button{
  flex:1;padding:12px;border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--card);color:var(--text)
}
.topbar button.active{
  border-color:rgba(124,92,255,.7);
  box-shadow:0 0 0 2px rgba(124,92,255,.15) inset;
}

.row{display:flex;gap:10px;margin-bottom:12px}
.card{flex:1;background:var(--card);border-radius:14px;padding:12px}
.card .label{color:var(--muted);font-size:13px}
.card .value{color:var(--accent);font-size:20px;margin-top:6px}

button.primary{
  width:100%;padding:16px;border-radius:16px;border:none;
  background:var(--accent);color:#fff;font-size:18px
}
button.primary.recording{background:var(--danger);animation:pulse 1.2s infinite}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(255,77,77,.5)}
  70%{box-shadow:0 0 0 16px rgba(255,77,77,0)}
  100%{box-shadow:0 0 0 0 rgba(255,77,77,0)}
}

.status{text-align:center;color:var(--muted);margin:10px 0}

.sectionTitle{
  display:flex;justify-content:space-between;
  margin:12px 0 6px;color:var(--accent);font-weight:600
}

.record{
  background:var(--card);border-radius:12px;
  padding:10px;margin:8px 0;
  display:flex;justify-content:space-between
}
.record .meta{color:var(--muted);font-size:12px}

.chart{
  display:flex;align-items:flex-end;gap:6px;height:160px;
  margin-top:10px;overflow-x:auto;padding-bottom:18px
}
.col{
  width:16px;border-radius:6px;
  background:rgba(124,92,255,.8);cursor:pointer;position:relative
}
.col.zero{background:rgba(255,255,255,.12)}
.col span{
  position:absolute;bottom:-16px;left:50%;
  transform:translateX(-50%);
  font-size:10px;color:var(--muted)
}
</style>
</head>

<body>
<div class="app">
  <h1>üéô Voice Cash</h1>

  <div class="topbar">
    <button id="btnDay" class="active">–¢—Ä–∞—Ç—ã –∑–∞ –¥–µ–Ω—å</button>
    <button id="btnMonth">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–µ—Å—è—Ü</button>
    <button id="btnYear">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ–¥</button>
  </div>

  <div class="row">
    <div class="card"><div class="label">–°–µ–≥–æ–¥–Ω—è</div><div class="value" id="sumToday">0</div></div>
    <div class="card"><div class="label">–ú–µ—Å—è—Ü</div><div class="value" id="sumMonth">0</div></div>
    <div class="card"><div class="label">–ì–æ–¥</div><div class="value" id="sumYear">0</div></div>
  </div>

  <button id="recBtn" class="primary">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
  <div class="status" id="status"></div>

  <!-- DAY -->
  <div id="viewDay">
    <div class="sectionTitle"><span>–°–µ–≥–æ–¥–Ω—è</span><span id="daySum">0</span></div>
    <div id="dayList"></div>
  </div>

  <!-- MONTH -->
  <div id="viewMonth" class="hidden">
    <div class="sectionTitle"><span>–≠—Ç–æ—Ç –º–µ—Å—è—Ü</span><span id="monthSum">0</span></div>
    <div class="chart" id="monthChart"></div>
  </div>

  <!-- YEAR -->
  <div id="viewYear" class="hidden">
    <div class="sectionTitle"><span>–≠—Ç–æ—Ç –≥–æ–¥</span><span id="yearSum">0</span></div>
    <div class="chart" id="yearChart"></div>
  </div>
</div>

<script>
const CATEGORY_RULES = [
  {category:'–ö–æ—Ñ–µ',keywords:['–∫–æ—Ñ–µ','–ª–∞—Ç—Ç–µ','–∫–∞–ø—É—á–∏–Ω–æ','—ç—Å–ø—Ä–µ—Å—Å–æ']},
  {category:'–ï–¥–∞',keywords:['–µ–¥–∞','—Ä–µ—Å—Ç–æ—Ä–∞–Ω','—à–∞—É—Ä–º–∞','–ø–∏—Ü—Ü–∞','–±—É—Ä–≥–µ—Ä']},
  {category:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',keywords:['—Ç–∞–∫—Å–∏','uber','–º–µ—Ç—Ä–æ','–∞–≤—Ç–æ–±—É—Å']},
  {category:'–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',keywords:['–∫–∏–Ω–æ','–±–∞—Ä','–∫–ª—É–±']}
];
const detectCategory = t=>{
  t=t.toLowerCase();
  for(const r of CATEGORY_RULES)
    for(const k of r.keywords)
      if(t.includes(k)) return r.category;
  return '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
};

const KEY='vc-records';
let records=JSON.parse(localStorage.getItem(KEY)||'[]');

const $=id=>document.getElementById(id);
const btnDay=$('btnDay'),btnMonth=$('btnMonth'),btnYear=$('btnYear');
const viewDay=$('viewDay'),viewMonth=$('viewMonth'),viewYear=$('viewYear');
const recBtn=$('recBtn'),statusEl=$('status');

btnDay.onclick=()=>setView('day');
btnMonth.onclick=()=>setView('month');
btnYear.onclick=()=>setView('year');

function setView(v){
  btnDay.classList.toggle('active',v==='day');
  btnMonth.classList.toggle('active',v==='month');
  btnYear.classList.toggle('active',v==='year');
  viewDay.classList.toggle('hidden',v!=='day');
  viewMonth.classList.toggle('hidden',v!=='month');
  viewYear.classList.toggle('hidden',v!=='year');
  render();
}

function nowISO(){return new Date().toISOString().slice(0,10);}
function nowMonth(){return nowISO().slice(0,7);}
function nowYear(){return nowISO().slice(0,4);}

function render(){
  let todaySum=0,monthSum=0,yearSum=0;
  const dayList=$('dayList'); dayList.innerHTML='';
  records.forEach(r=>{
    if(r.date===nowISO()){todaySum+=r.amount;
      const d=document.createElement('div');
      d.className='record';
      d.innerHTML=`<div>${r.item}<div class="meta">${r.time}</div></div><div>${r.amount}</div>`;
      dayList.appendChild(d);
    }
    if(r.date.startsWith(nowMonth())) monthSum+=r.amount;
    if(r.date.startsWith(nowYear())) yearSum+=r.amount;
  });
  $('sumToday').textContent=todaySum;
  $('sumMonth').textContent=monthSum;
  $('sumYear').textContent=yearSum;
  $('daySum').textContent=todaySum;
  $('monthSum').textContent=monthSum;
  $('yearSum').textContent=yearSum;
}

let recognition,isRecording=false;
recBtn.onclick=()=>isRecording?stopRec():startRec();

function startRec(){
  if(!('webkitSpeechRecognition'in window)){alert('–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥–æ–ª–æ—Å–∞');return;}
  recognition=new webkitSpeechRecognition();
  recognition.lang='ru-RU';
  recognition.onresult=e=>parseVoice(e.results[0][0].transcript);
  recognition.onend=()=>stopRec();
  isRecording=true;
  recBtn.classList.add('recording');
  recBtn.textContent='‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
  statusEl.textContent='–ì–æ–≤–æ—Ä–∏: "–∫–æ—Ñ–µ 200"';
  recognition.start();
}
function stopRec(){
  if(recognition) recognition.stop();
  isRecording=false;
  recBtn.classList.remove('recording');
  recBtn.textContent='üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';
}
function parseVoice(text){
  const m=text.toLowerCase().match(/(.+)\s(\d+)/);
  if(!m){statusEl.textContent='–ù–µ –ø–æ–Ω—è–ª';return;}
  const item=m[1].trim(),amount=+m[2];
  records.unshift({
    id:crypto.randomUUID(),
    item,amount,
    category:detectCategory(item),
    date:nowISO(),
    time:new Date().toTimeString().slice(0,5)
  });
  localStorage.setItem(KEY,JSON.stringify(records));
  statusEl.textContent=`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${item} ${amount}`;
  render();
}

render();
</script>
</body>
</html>
