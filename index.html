<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Cash</title>

<style>
:root{
  --bg:#0f0f14;
  --card:#1a1a26;
  --accent:#7c5cff;
  --danger:#ff4d4d;
  --text:#fff;
  --muted:#9a9ab3;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
.app{
  max-width:520px;
  margin:auto;
  padding:16px;
}
h1{
  text-align:center;
  margin:10px 0 14px;
}

/* top buttons */
.topbar{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
.topbar button{
  flex:1;
  padding:12px;
  border-radius:14px;
  background:var(--card);
  color:var(--text);
  border:1px solid rgba(255,255,255,.08);
}
.topbar button.active{
  border-color:var(--accent);
}

/* summary */
.row{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
.card{
  flex:1;
  background:var(--card);
  border-radius:14px;
  padding:12px;
}
.card .label{
  color:var(--muted);
  font-size:13px;
}
.card .value{
  color:var(--accent);
  font-size:20px;
  margin-top:6px;
}

/* voice */
button.primary{
  width:100%;
  padding:16px;
  border-radius:16px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-size:18px;
}
button.primary.recording{
  background:var(--danger);
  animation:pulse 1.5s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{opacity:1}
  50%{opacity:0.6}
}
.status{
  text-align:center;
  color:var(--muted);
  margin:10px 0;
}

/* records */
.record{
  background:var(--card);
  border-radius:12px;
  padding:10px;
  margin:8px 0;
  display:flex;
  align-items:center;
  gap:10px;
}
.icon{
  font-size:22px;
  width:28px;
  text-align:center;
}
.recMain{
  flex:1;
}
.recTitle{
  font-size:15px;
}
.recMeta{
  color:var(--muted);
  font-size:12px;
}
.recRight{
  display:flex;
  align-items:center;
  gap:8px;
}
.amount{
  font-size:16px;
}
.menuBtn{
  background:transparent;
  border:none;
  color:var(--muted);
  font-size:20px;
  cursor:pointer;
}

/* modal & overlay */
.overlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  display:none;
  z-index:100;
}
.overlay.show{
  display:flex;
  align-items:flex-end;
  justify-content:center;
}
.actionMenu{
  background:var(--card);
  border-radius:20px 20px 0 0;
  padding:20px;
  width:100%;
  max-width:520px;
}
.actionMenu button{
  width:100%;
  padding:16px;
  background:transparent;
  border:none;
  color:var(--text);
  font-size:16px;
  text-align:left;
  border-radius:12px;
  margin:6px 0;
  cursor:pointer;
}
.actionMenu button:hover{
  background:rgba(255,255,255,0.05);
}
.actionMenu button.danger{
  color:var(--danger);
}

/* edit panel */
.editPanel{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}
.editPanel.show{
  display:flex;
}
.editForm{
  background:var(--card);
  border-radius:20px;
  padding:24px;
  width:90%;
  max-width:400px;
}
.editForm h2{
  margin:0 0 20px;
  font-size:20px;
}
.formGroup{
  margin-bottom:16px;
}
.formGroup label{
  display:block;
  color:var(--muted);
  font-size:13px;
  margin-bottom:6px;
}
.formGroup input{
  width:100%;
  padding:12px;
  background:var(--bg);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:10px;
  color:var(--text);
  font-size:15px;
}
.formActions{
  display:flex;
  gap:10px;
  margin-top:20px;
}
.formActions button{
  flex:1;
  padding:14px;
  border-radius:12px;
  border:none;
  font-size:16px;
  cursor:pointer;
}
.formActions .btnSave{
  background:var(--accent);
  color:#fff;
}
.formActions .btnCancel{
  background:transparent;
  color:var(--muted);
  border:1px solid rgba(255,255,255,0.1);
}
</style>
</head>

<body>
<div class="app">
  <h1>üéô Voice Cash</h1>

  <div class="topbar">
    <button class="active">–¢—Ä–∞—Ç—ã –∑–∞ –¥–µ–Ω—å</button>
    <button>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–µ—Å—è—Ü</button>
    <button>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ–¥</button>
  </div>

  <div class="row">
    <div class="card">
      <div class="label">–°–µ–≥–æ–¥–Ω—è</div>
      <div class="value" id="sumToday">0</div>
    </div>
    <div class="card">
      <div class="label">–ú–µ—Å—è—Ü</div>
      <div class="value" id="sumMonth">0</div>
    </div>
    <div class="card">
      <div class="label">–ì–æ–¥</div>
      <div class="value" id="sumYear">0</div>
    </div>
  </div>

  <button id="recBtn" class="primary">üé§ Start recording</button>
  <div class="status" id="status"></div>

  <div id="list"></div>
</div>

<div id="actionOverlay" class="overlay">
  <div class="actionMenu">
    <button id="editBtn">‚úèÔ∏è Edit</button>
    <button id="deleteBtn" class="danger">üóëÔ∏è Delete</button>
  </div>
</div>

<div id="editPanel" class="editPanel">
  <div class="editForm">
    <h2>Edit Expense</h2>
    <div class="formGroup">
      <label>Category</label>
      <input type="text" id="editCategory">
    </div>
    <div class="formGroup">
      <label>Amount</label>
      <input type="number" id="editAmount">
    </div>
    <div class="formGroup">
      <label>Date</label>
      <input type="date" id="editDate">
    </div>
    <div class="formActions">
      <button class="btnCancel" id="cancelEdit">Cancel</button>
      <button class="btnSave" id="saveEdit">Save</button>
    </div>
  </div>
</div>

<script>
const KEY='vc-data';
let records=JSON.parse(localStorage.getItem(KEY)||'[]');

const ICONS={
  '–ö–æ—Ñ–µ':'üçó',
  '–ï–¥–∞':'üçó',
  '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç':'üöï',
  '–°–≤—è–∑—å':'üì∂',
  '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ':'‚ùì'
};

const RULES=[
 {c:'–ö–æ—Ñ–µ',k:['–∫–æ—Ñ–µ','–ª–∞—Ç—Ç–µ','–∫–∞–ø—É—á–∏–Ω–æ']},
 {c:'–ï–¥–∞',k:['–µ–¥–∞','–ø–∏—Ü—Ü–∞','—à–∞—É—Ä–º–∞','—Ä–µ—Å—Ç–æ—Ä–∞–Ω']},
 {c:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',k:['—Ç–∞–∫—Å–∏','–º–µ—Ç—Ä–æ','–∞–≤—Ç–æ–±—É—Å']}
];

function detectCat(text){
 text=text.toLowerCase();
 for(const r of RULES)
  for(const k of r.k)
   if(text.includes(k)) return r.c;
 return '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
}

function today(){
 return new Date().toISOString().slice(0,10);
}

function render(){
 let t=0,m=0,y=0;
 const list=document.getElementById('list');
 list.innerHTML='';
 records.forEach(r=>{
  if(r.date===today()){
   t+=r.amount;
   const row=document.createElement('div');
   row.className='record';
   row.innerHTML=`
    <div class="icon">${ICONS[r.category]||'‚ùì'}</div>
    <div class="recMain">
      <div class="recTitle">${r.item}</div>
      <div class="recMeta">${r.category}</div>
    </div>
    <div class="recRight">
      <div class="amount">${r.amount}</div>
      <button class="menuBtn" data-id="${r.id}">‚ãÆ</button>
    </div>`;
   list.appendChild(row);
   row.querySelector('.menuBtn').onclick=()=>openActionMenu(r.id);
  }
  if(r.date.slice(0,7)===today().slice(0,7)) m+=r.amount;
  if(r.date.slice(0,4)===today().slice(0,4)) y+=r.amount;
 });
 document.getElementById('sumToday').textContent=t;
 document.getElementById('sumMonth').textContent=m;
 document.getElementById('sumYear').textContent=y;
}

let rec,isRec=false;
const btn=document.getElementById('recBtn');

function stopRecording(){
 isRec=false;
 btn.classList.remove('recording');
 btn.textContent='üé§ Start recording';
}

btn.onclick=()=>{
 if(isRec){
  rec.stop();
  return;
 }
 rec=new webkitSpeechRecognition();
 rec.lang='ru-RU';
 rec.onresult=e=>{
  const t=e.results[0][0].transcript;
  if(!t) return;
  const m=t.match(/(.+)\s(\d+)/);
  if(!m) return;
  records.unshift({
   id:crypto.randomUUID(),
   item:m[1].trim(),
   amount:+m[2],
   category:detectCat(m[1]),
   date:today()
  });
  localStorage.setItem(KEY,JSON.stringify(records));
  render();
 };
 rec.onend=stopRecording;
 rec.start();
 isRec=true;
 btn.classList.add('recording');
 btn.textContent='‚è∫ Recording‚Ä¶';
};

// action menu & edit logic
let currentRecordId=null;
const actionOverlay=document.getElementById('actionOverlay');
const editPanel=document.getElementById('editPanel');

function openActionMenu(id){
 currentRecordId=id;
 actionOverlay.classList.add('show');
}

function closeActionMenu(){
 actionOverlay.classList.remove('show');
 currentRecordId=null;
}

function deleteRecord(){
 records=records.filter(r=>r.id!==currentRecordId);
 localStorage.setItem(KEY,JSON.stringify(records));
 closeActionMenu();
 render();
}

function openEditPanel(){
 const record=records.find(r=>r.id===currentRecordId);
 if(!record) return;
 document.getElementById('editCategory').value=record.category;
 document.getElementById('editAmount').value=record.amount;
 document.getElementById('editDate').value=record.date;
 closeActionMenu();
 editPanel.classList.add('show');
}

function closeEditPanel(){
 editPanel.classList.remove('show');
 currentRecordId=null;
}

function saveEdit(){
 const record=records.find(r=>r.id===currentRecordId);
 if(!record) return;
 record.category=document.getElementById('editCategory').value;
 record.amount=+document.getElementById('editAmount').value;
 record.date=document.getElementById('editDate').value;
 localStorage.setItem(KEY,JSON.stringify(records));
 closeEditPanel();
 render();
}

// event listeners
actionOverlay.onclick=(e)=>{
 if(e.target===actionOverlay) closeActionMenu();
};
document.getElementById('editBtn').onclick=openEditPanel;
document.getElementById('deleteBtn').onclick=deleteRecord;
editPanel.onclick=(e)=>{
 if(e.target===editPanel) closeEditPanel();
};
document.getElementById('cancelEdit').onclick=closeEditPanel;
document.getElementById('saveEdit').onclick=saveEdit;

render();
</script>
</body>
</html>
