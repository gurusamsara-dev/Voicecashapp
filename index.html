<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Cash</title>

<style>
:root{
--bg:#0f0f14;--card:#1a1a26;--accent:#7c5cff;
--danger:#ff4d4d;--text:#fff;--muted:#9a9ab3
}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.app{max-width:480px;margin:auto;padding:20px}
h1{text-align:center}
.summary{display:flex;justify-content:space-between;margin:12px 0}
.box{background:var(--card);padding:12px;border-radius:12px;width:48%;text-align:center}
.big{font-size:18px;color:var(--accent)}
button{width:100%;padding:16px;font-size:18px;border-radius:16px;border:none;background:var(--accent);color:#fff}
button.recording{background:var(--danger);animation:pulse 1.2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,77,77,.6)}70%{box-shadow:0 0 0 18px rgba(255,77,77,0)}}
.status{text-align:center;color:var(--muted);margin:8px}
.day{margin-top:18px}
.day-header{display:flex;justify-content:space-between;color:var(--accent)}
.record{background:var(--card);padding:12px;border-radius:12px;display:flex;justify-content:space-between;margin-top:6px}
.time{font-size:12px;color:var(--muted)}
.hidden{display:none}
</style>
</head>

<body>
<div class="app">
<h1>üéô Voice Cash</h1>

<div class="summary">
<div class="box">
<div>–°–µ–≥–æ–¥–Ω—è</div>
<div class="big" id="todaySum">0</div>
</div>
<div class="box">
<div>–ú–µ—Å—è—Ü</div>
<div class="big" id="monthSum">0</div>
</div>
</div>

<button id="recBtn">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
<div class="status" id="status"></div>

<button onclick="toggleAnalytics()">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>

<div id="archive"></div>
<div id="analytics" class="hidden"></div>
</div>

<script>
let rec=false,recognition=null;
let records=JSON.parse(localStorage.getItem('vc-records'))||[];

const $=id=>document.getElementById(id);
const today=()=>new Date().toISOString().slice(0,10);
const month=()=>today().slice(0,7);
const time=()=>new Date().toTimeString().slice(0,5);

function label(date){
const d=new Date(date),t=new Date(),y=new Date(Date.now()-86400000);
if(d.toDateString()==t.toDateString())return"–°–µ–≥–æ–¥–Ω—è";
if(d.toDateString()==y.toDateString())return"–í—á–µ—Ä–∞";
return date;
}

function render(){
$('archive').innerHTML='';$('analytics').innerHTML='';
let tSum=0,mSum=0,byDay={},byCat={};

records.forEach(r=>{
if(r.date==today())tSum+=r.amount;
if(r.date.startsWith(month()))mSum+=r.amount;
byDay[r.date]=(byDay[r.date]||[]).concat(r);
byCat[r.category]=(byCat[r.category]||0)+r.amount;
});

$('todaySum').textContent=tSum;
$('monthSum').textContent=mSum;

Object.keys(byDay).sort().reverse().forEach(d=>{
const sum=byDay[d].reduce((s,r)=>s+r.amount,0);
let day=document.createElement('div');day.className='day';
day.innerHTML=`<div class="day-header"><span>${label(d)}</span><span>${sum}</span></div>`;
byDay[d].forEach(r=>{
day.innerHTML+=`<div class="record">
<div>${r.item}<div class="time">${r.time} ¬∑ ${r.category}</div></div>
<div>${r.amount}</div></div>`;
});
$('archive').appendChild(day);
});

// analytics
let maxDay=Object.entries(byDay).sort((a,b)=>b[1].reduce((s,r)=>s+r.amount,0)-a[1].reduce((s,r)=>s+r.amount,0))[0];
let topCat=Object.entries(byCat).sort((a,b)=>b[1]-a[1])[0];
$('analytics').innerHTML=`
<h2>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
<div class="record">–í—Å–µ–≥–æ –∑–∞ –º–µ—Å—è—Ü <b>${mSum}</b></div>
<div class="record">–°—Ä–µ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å <b>${Math.round(mSum/Object.keys(byDay).length||0)}</b></div>
<div class="record">–ú–∞–∫—Å –¥–µ–Ω—å <b>${maxDay?label(maxDay[0]):'-'}</b></div>
<div class="record">–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è <b>${topCat?topCat[0]:'-'}</b></div>
`;
}

render();

$('recBtn').onclick=()=>rec?stop():start();

function start(){
if(!('webkitSpeechRecognition'in window))return alert('No voice');
recognition=new webkitSpeechRecognition();
recognition.lang='ru-RU';recognition.start();
rec=true;$('recBtn').classList.add('recording');
$('recBtn').textContent='‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
$('status').textContent='–°–ª—É—à–∞—é‚Ä¶';
recognition.onresult=e=>parse(e.results[0][0].transcript.toLowerCase());
recognition.onend=stop;
}

function stop(){
if(recognition)recognition.stop();
rec=false;$('recBtn').classList.remove('recording');
$('recBtn').textContent='üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';
$('status').textContent='';
}

function parse(t){
$('status').textContent=`"${t}"`;
if(t.includes('–ø–æ–∫–∞–∂–∏'))return command(t);

let m=t.match(/(.+?)\s(\w+)?\s?(\d+)/);
if(!m)return;
records.unshift({
item:m[1],
category:m[2]||'–ø—Ä–æ—á–µ–µ',
amount:+m[3],
date:today(),time:time()
});
localStorage.setItem('vc-records',JSON.stringify(records));
render();
}

function command(t){
if(t.includes('–∞–Ω–∞–ª–∏—Ç–∏'))toggleAnalytics(true);
if(t.includes('—Å–µ–≥–æ–¥–Ω—è'))scrollTo(0,0);
}

function toggleAnalytics(force){
$('analytics').classList.toggle('hidden',force===false);
$('archive').classList.toggle('hidden',force===true);
}
</script>
</body>
</html>
