<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Cash</title>

<style>
:root {
  --bg:#0f0f14;
  --card:#1a1a26;
  --accent:#7c5cff;
  --danger:#ff4d4d;
  --text:#fff;
  --muted:#9a9ab3;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, -apple-system, BlinkMacSystemFont;
}

.app {
  max-width:480px;
  margin:auto;
  padding:20px;
}

h1 {
  text-align:center;
  margin:10px 0 6px;
}

.cards {
  display:flex;
  gap:10px;
  margin-bottom:14px;
}

.card {
  flex:1;
  background:var(--card);
  padding:12px;
  border-radius:14px;
  text-align:center;
}

.card .label { color:var(--muted); font-size:14px; }
.card .value { color:var(--accent); font-size:20px; margin-top:4px; }

button {
  width:100%;
  padding:18px;
  font-size:18px;
  border-radius:18px;
  border:none;
  background:var(--accent);
  color:white;
  margin-bottom:10px;
}

button.recording {
  background:var(--danger);
  animation:pulse 1.2s infinite;
}

@keyframes pulse {
  0% { box-shadow:0 0 0 0 rgba(255,77,77,.6); }
  70% { box-shadow:0 0 0 18px rgba(255,77,77,0); }
  100% { box-shadow:0 0 0 0 rgba(255,77,77,0); }
}

.status {
  text-align:center;
  color:var(--muted);
  margin-bottom:10px;
}

.hidden { display:none; }

.day {
  margin-top:16px;
}

.day-header {
  display:flex;
  justify-content:space-between;
  color:var(--accent);
  margin-bottom:6px;
}

.record {
  background:var(--card);
  padding:12px;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

.time {
  color:var(--muted);
  font-size:13px;
}
</style>
</head>

<body>
<div class="app">

  <h1>üéô Voice Cash</h1>

  <div class="cards">
    <div class="card">
      <div class="label">–°–µ–≥–æ–¥–Ω—è</div>
      <div class="value" id="todaySum">0</div>
    </div>
    <div class="card">
      <div class="label">–ú–µ—Å—è—Ü</div>
      <div class="value" id="monthSum">0</div>
    </div>
  </div>

  <button id="recBtn">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
  <button onclick="toggleAnalytics()">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>

  <div class="status" id="status"></div>

  <div id="archive"></div>
  <div id="analytics" class="hidden"></div>

</div>

<script>
/* ========= STATE ========= */
let recognition = null;
let isRecording = false;
let analyticsOpen = false;

let records = JSON.parse(localStorage.getItem('vc-records')) || [];

/* ========= ELEMENTS ========= */
const recBtn = document.getElementById('recBtn');
const archiveEl = document.getElementById('archive');
const analyticsEl = document.getElementById('analytics');
const statusEl = document.getElementById('status');
const todayEl = document.getElementById('todaySum');
const monthEl = document.getElementById('monthSum');

/* ========= HELPERS ========= */
const today = () => new Date().toISOString().slice(0,10);
const nowTime = () => new Date().toTimeString().slice(0,5);
const month = () => today().slice(0,7);

/* ========= RENDER ========= */
function render() {
  archiveEl.innerHTML = '';
  analyticsEl.innerHTML = '';

  let todaySum = 0;
  let monthSum = 0;

  const byDay = {};

  records.forEach(r => {
    if (r.date === today()) todaySum += r.amount;
    if (r.date.startsWith(month())) monthSum += r.amount;

    byDay[r.date] = byDay[r.date] || [];
    byDay[r.date].push(r);
  });

  todayEl.textContent = todaySum;
  monthEl.textContent = monthSum;

  Object.keys(byDay).sort().reverse().forEach(date => {
    const sum = byDay[date].reduce((s,r)=>s+r.amount,0);

    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';

    dayDiv.innerHTML = `
      <div class="day-header">
        <span>${date}</span>
        <span>${sum}</span>
      </div>
    `;

    byDay[date].forEach(r => {
      const row = document.createElement('div');
      row.className = 'record';
      row.innerHTML = `
        <div>
          <div>${r.item}</div>
          <div class="time">${r.time}</div>
        </div>
        <div>${r.amount}</div>
      `;
      dayDiv.appendChild(row);
    });

    archiveEl.appendChild(dayDiv);
  });
}

/* ========= ANALYTICS TOGGLE ========= */
function toggleAnalytics() {
  analyticsOpen = !analyticsOpen;
  analyticsEl.classList.toggle('hidden', !analyticsOpen);
  archiveEl.classList.toggle('hidden', analyticsOpen);

  if (analyticsOpen) {
    analyticsEl.innerHTML = `
      <div class="day-header">
        <span>–ó–∞–ø–∏—Å–µ–π</span>
        <span>${records.length}</span>
      </div>
    `;
  }
}

/* ========= VOICE ========= */
recBtn.onclick = () => isRecording ? stopRec() : startRec();

function startRec() {
  if (!('webkitSpeechRecognition' in window)) {
    alert('–ì–æ–ª–æ—Å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
    return;
  }

  recognition = new webkitSpeechRecognition();
  recognition.lang = 'ru-RU';
  recognition.start();

  isRecording = true;
  recBtn.classList.add('recording');
  recBtn.textContent = '‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
  statusEl.textContent = 'üéô –ì–æ–≤–æ—Ä–∏: "–∫–æ—Ñ–µ 200"';

  recognition.onresult = e => parseSpeech(e.results[0][0].transcript.toLowerCase());
  recognition.onend = stopRec;
}

function stopRec() {
  if (recognition) recognition.stop();
  isRecording = false;
  recBtn.classList.remove('recording');
  recBtn.textContent = 'üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';
}

/* ========= PARSER ========= */
function parseSpeech(text) {
  statusEl.textContent = `"${text}"`;

  const match = text.match(/^(.*)\s(\d+)$/);
  if (!match) {
    statusEl.textContent = '–ù–µ –ø–æ–Ω—è–ª. –ü—Ä–∏–º–µ—Ä: "–∫–æ—Ñ–µ 200"';
    return;
  }

  const item = match[1].trim();
  const amount = parseInt(match[2],10);

  if (!item || !amount) return;

  records.unshift({
    id: crypto.randomUUID(),
    item,
    amount,
    date: today(),
    time: nowTime(),
    ts: Date.now()
  });

  localStorage.setItem('vc-records', JSON.stringify(records));
  render();
}

render();
</script>
</body>
</html>
