<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Cash</title>

<style>
:root{
  --bg:#0f0f14;
  --card:#1a1a26;
  --accent:#7c5cff;
  --danger:#ff4d4d;
  --text:#fff;
  --muted:#9a9ab3;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
.app{
  max-width:520px;
  margin:auto;
  padding:16px;
  position:relative;
  overflow:hidden;
}
h1{
  text-align:center;
  margin:10px 0 14px;
  position:relative;
  animation:neonGlow 3s ease-in-out infinite,neonFlicker 8s linear infinite;
  will-change:text-shadow,filter;
}

body.paused h1{
  animation:none;
  text-shadow:0 0 10px rgba(124,92,255,0.5),0 0 20px rgba(124,92,255,0.3);
}

.app::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:2px;
  background:linear-gradient(90deg,transparent,rgba(124,92,255,0.6),transparent);
  animation:shimmer 3s ease-in-out infinite;
  will-change:transform;
  opacity:0.5;
}

body.paused .app::before{
  animation:none;
}

h1 .mic-icon{
  display:inline-block;
  animation:micPulse 2s ease-in-out infinite;
  will-change:transform,filter;
}

body.paused h1 .mic-icon{
  animation:none;
  filter:drop-shadow(0 0 2px rgba(124,92,255,0.3));
}

#recBtn{
  position:relative;
  overflow:visible;
}

#recBtn::before{
  content:'üé§';
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  font-size:18px;
  pointer-events:none;
  animation:micPulse 2s ease-in-out infinite;
  will-change:transform,filter;
}

body.paused #recBtn::before{
  animation:none;
  filter:drop-shadow(0 0 2px rgba(124,92,255,0.3));
}

/* top buttons */
.topbar{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
.topbar button{
  flex:1;
  padding:12px;
  border-radius:14px;
  background:var(--card);
  color:var(--text);
  border:1px solid rgba(255,255,255,.08);
}
.topbar button.active{
  border-color:var(--accent);
}

/* summary */
.row{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
.card{
  flex:1;
  background:var(--card);
  border-radius:14px;
  padding:12px;
}
.card .label{
  color:var(--muted);
  font-size:13px;
}
.card .value{
  color:var(--accent);
  font-size:20px;
  margin-top:6px;
}

/* voice */
button.primary{
  width:100%;
  padding:16px;
  border-radius:16px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-size:18px;
}
button.primary.recording{
  background:var(--danger);
  animation:pulse 1.5s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{opacity:1}
  50%{opacity:0.6}
}

/* Neon animations */
@keyframes neonGlow{
  0%,100%{
    text-shadow:0 0 10px rgba(124,92,255,0.5),0 0 20px rgba(124,92,255,0.3),0 0 30px rgba(124,92,255,0.2);
    filter:brightness(1);
  }
  50%{
    text-shadow:0 0 15px rgba(124,92,255,0.7),0 0 30px rgba(124,92,255,0.5),0 0 45px rgba(124,92,255,0.3);
    filter:brightness(1.15);
  }
}

@keyframes neonFlicker{
  0%,100%{opacity:1}
  92%{opacity:0.95}
  94%{opacity:1}
  96%{opacity:0.97}
  98%{opacity:1}
}

@keyframes shimmer{
  0%{transform:translateX(-100%)}
  100%{transform:translateX(100%)}
}

@keyframes micPulse{
  0%,100%{
    transform:scale(1);
    filter:drop-shadow(0 0 2px rgba(124,92,255,0.3));
  }
  50%{
    transform:scale(1.05);
    filter:drop-shadow(0 0 8px rgba(124,92,255,0.6));
  }
}

@keyframes slideInFromRight{
  from{
    opacity:0;
    transform:translateX(20px);
  }
  to{
    opacity:1;
    transform:translateX(0);
  }
}

@keyframes slideInFromLeft{
  from{
    opacity:0;
    transform:translateX(-20px);
  }
  to{
    opacity:1;
    transform:translateX(0);
  }
}

.view-content{
  animation-duration:0.25s;
  animation-timing-function:ease-out;
  animation-fill-mode:both;
}

.view-content.slide-left{
  animation-name:slideInFromRight;
}

.view-content.slide-right{
  animation-name:slideInFromLeft;
}

.status{
  text-align:center;
  color:var(--muted);
  margin:10px 0;
}
.viewToggle{
  display:flex;
  gap:0;
  margin:20px 0;
  background:rgba(255,255,255,0.05);
  border-radius:12px;
  padding:4px;
}
.viewToggleBtn{
  flex:1;
  padding:10px 16px;
  background:transparent;
  border:none;
  color:var(--muted);
  font-size:14px;
  font-weight:500;
  border-radius:8px;
  cursor:pointer;
  transition:all 0.2s;
}
.viewToggleBtn.active{
  background:var(--accent);
  color:var(--bg);
}
.viewToggleBtn:hover:not(.active){
  color:var(--text);
}

/* records */
.record{
  background:var(--card);
  border-radius:12px;
  padding:10px;
  margin:8px 0;
  display:flex;
  align-items:center;
  gap:10px;
}
.icon{
  font-size:22px;
  width:28px;
  text-align:center;
}
.recMain{
  flex:1;
}
.recTitle{
  font-size:15px;
}
.recMeta{
  color:var(--muted);
  font-size:12px;
}
.recRight{
  display:flex;
  align-items:center;
  gap:8px;
}
.amount{
  font-size:16px;
}
.menuBtn{
  background:transparent;
  border:none;
  color:var(--muted);
  font-size:20px;
  cursor:pointer;
}

/* modal & overlay */
.overlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  display:none;
  z-index:250;
}
.overlay.show{
  display:flex;
  align-items:flex-end;
  justify-content:center;
}
.actionMenu{
  background:var(--card);
  border-radius:20px 20px 0 0;
  padding:20px;
  width:100%;
  max-width:520px;
}
.actionMenu button{
  width:100%;
  padding:16px;
  background:transparent;
  border:none;
  color:var(--text);
  font-size:16px;
  text-align:left;
  border-radius:12px;
  margin:6px 0;
  cursor:pointer;
}
.actionMenu button:hover{
  background:rgba(255,255,255,0.05);
}
.actionMenu button.danger{
  color:var(--danger);
}

/* edit panel */
.editPanel{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}
.editPanel.show{
  display:flex;
}
#chartPanel{
  z-index:150;
}
.editForm{
  background:var(--card);
  border-radius:20px;
  padding:24px;
  width:90%;
  max-width:400px;
}
.editForm h2{
  margin:0 0 20px;
  font-size:20px;
}
.formGroup{
  margin-bottom:16px;
}
.formGroup label{
  display:block;
  color:var(--muted);
  font-size:13px;
  margin-bottom:6px;
}
.formGroup input,.formGroup select{
  width:100%;
  padding:12px;
  background:var(--bg);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:10px;
  color:var(--text);
  font-size:15px;
  cursor:pointer;
}
.formGroup select{
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%239a9ab3" d="M1.41 0L6 4.58 10.59 0 12 1.41l-6 6-6-6z"/></svg>');
  background-repeat:no-repeat;
  background-position:right 12px center;
  padding-right:40px;
}
.formActions{
  display:flex;
  gap:10px;
  margin-top:20px;
}
.formActions button{
  flex:1;
  padding:14px;
  border-radius:12px;
  border:none;
  font-size:16px;
  cursor:pointer;
}
.formActions .btnSave{
  background:var(--accent);
  color:#fff;
}
.formActions .btnCancel{
  background:transparent;
  color:var(--muted);
  border:1px solid rgba(255,255,255,0.1);
}

/* charts */
.chartView{
  padding:16px;
  max-height:90vh;
  overflow-y:auto;
}
.chartView h3{
  margin:0 0 16px;
  font-size:18px;
}
.chartContainer{
  margin-bottom:20px;
}
.chartScroll{
  overflow-x:auto;
  overflow-y:hidden;
  margin-bottom:30px;
}
.chart{
  display:flex;
  align-items:flex-end;
  height:200px;
  gap:8px;
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.1);
  min-width:max-content;
}
.bar{
  width:48px;
  background:var(--accent);
  border-radius:6px 6px 0 0;
  min-height:2px;
  cursor:pointer;
  transition:all 0.2s;
  position:relative;
}
.bar.selected{
  background:var(--danger);
}
.bar:hover{
  opacity:0.8;
}
.barLabel{
  position:absolute;
  bottom:-24px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  font-weight:500;
  pointer-events:none;
}
.monthHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:20px;
  padding:0 10px;
}
.monthNav{
  background:transparent;
  border:none;
  color:var(--accent);
  font-size:24px;
  cursor:pointer;
  padding:8px 12px;
  border-radius:8px;
}
.monthNav:hover{
  background:rgba(124,92,255,0.1);
}
.monthNav:disabled{
  color:var(--muted);
  opacity:0.3;
  cursor:not-allowed;
}
.monthTitle{
  font-size:20px;
  font-weight:600;
  color:var(--text);
  min-width:200px;
  text-align:center;
}
.categoryChart{
  padding:16px;
  margin-bottom:16px;
}
.categoryBar{
  margin-bottom:12px;
  cursor:pointer;
  transition:opacity 0.2s;
}
.categoryBar:hover{
  opacity:0.8;
}
.categoryBarLabel{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-size:13px;
  color:var(--text);
}
.categoryBarLabel span:last-child{
  font-weight:600;
  color:var(--accent);
}
.categoryBarTrack{
  height:24px;
  background:rgba(255,255,255,0.05);
  border-radius:12px;
  overflow:hidden;
}
.categoryBarFill{
  height:100%;
  border-radius:12px;
  transition:width 0.3s ease;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding-right:8px;
  font-size:11px;
  font-weight:600;
  color:rgba(0,0,0,0.7);
}
.expenseList{
  margin-top:20px;
}
.expenseList h4{
  margin:0 0 12px;
  font-size:16px;
  color:var(--accent);
}

/* settings */
.settingsBtn{
  position:absolute;
  top:16px;
  right:16px;
  background:transparent;
  border:none;
  color:var(--text);
  font-size:24px;
  cursor:pointer;
  padding:8px;
  z-index:1000;
}
.page{
  display:none;
}
.page.active{
  display:block;
}
.settingsPage{
  max-width:520px;
  margin:auto;
  padding:16px;
}
.settingsHeader{
  display:flex;
  align-items:center;
  margin-bottom:24px;
}
.backBtn{
  background:transparent;
  border:none;
  color:var(--text);
  font-size:24px;
  cursor:pointer;
  padding:8px;
  margin-right:12px;
}
.settingsHeader h2{
  margin:0;
  font-size:24px;
}
.settingItem{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:12px;
}
.settingLabel{
  color:var(--muted);
  font-size:13px;
  margin-bottom:8px;
}
.settingItem select{
  width:100%;
  padding:12px;
  padding-right:40px;
  background:var(--bg);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:10px;
  color:var(--text);
  font-size:15px;
  cursor:pointer;
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%239a9ab3" d="M1.41 0L6 4.58 10.59 0 12 1.41l-6 6-6-6z"/></svg>');
  background-repeat:no-repeat;
  background-position:right 12px center;
}
.settingItem select:hover{
  border-color:var(--accent);
}
.settingItem select option{
  background:var(--bg);
  color:var(--text);
}

/* currency selector */
.currencySelector{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  display:none;
  align-items:flex-end;
  justify-content:center;
  z-index:300;
}
.currencySelector.show{
  display:flex;
}
.currencyPanel{
  background:var(--card);
  border-radius:20px 20px 0 0;
  padding:20px;
  width:100%;
  max-width:520px;
  height:70vh;
  display:flex;
  flex-direction:column;
  position:relative;
}
.currencyPanel h3{
  margin:0 0 16px;
  font-size:18px;
  flex-shrink:0;
}
.currencySearch{
  width:100%;
  padding:12px;
  background:var(--bg);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:10px;
  color:var(--text);
  font-size:15px;
  margin-bottom:12px;
  flex-shrink:0;
  position:sticky;
  top:0;
  z-index:10;
}
.currencySearch:focus{
  outline:none;
  border-color:var(--accent);
}
.currencyList{
  overflow-y:auto;
  flex:1;
  min-height:0;
}
.currencyItem{
  padding:14px;
  background:transparent;
  border:none;
  color:var(--text);
  font-size:15px;
  text-align:left;
  border-radius:10px;
  margin:4px 0;
  cursor:pointer;
  width:100%;
  display:flex;
  align-items:center;
  gap:10px;
}
.currencyItem:hover{
  background:rgba(255,255,255,0.05);
}
.currencyItem.selected{
  background:var(--accent);
  color:#fff;
}
.currencyCode{
  font-weight:600;
  min-width:50px;
}
.currencyName{
  color:var(--muted);
  font-size:13px;
}
.currencyItem.selected .currencyName{
  color:rgba(255,255,255,0.8);
}
.settingItem button{
  width:100%;
  padding:12px;
  background:var(--bg);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:10px;
  color:var(--text);
  font-size:15px;
  cursor:pointer;
  text-align:left;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.settingItem button:hover{
  border-color:var(--accent);
}
.settingItem button span:last-child{
  color:var(--muted);
  font-size:12px;
  width:12px;
  height:12px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.version{
  position:fixed;
  top:8px;
  left:8px;
  font-size:10px;
  color:var(--muted);
  opacity:0.6;
  z-index:1000;
  font-weight:500;
  user-select:none;
}
</style>
</head>

<body>
<div class="version">v2.4.0</div>
<button class="settingsBtn" id="settingsBtn">‚öôÔ∏è</button>

<div id="mainPage" class="page active">
  <div class="app">
    <h1 id="appTitle"><span class="mic-icon">üí∏</span> Voice Cash</h1>

    <div class="topbar">
      <button class="active" id="todayBtn">–¢—Ä–∞—Ç—ã –∑–∞ –¥–µ–Ω—å</button>
      <button id="monthBtn">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–µ—Å—è—Ü</button>
      <button id="yearBtn">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ–¥</button>
    </div>

    <div class="row">
      <div class="card">
        <div class="label" id="labelToday">–°–µ–≥–æ–¥–Ω—è</div>
        <div class="value" id="sumToday">0</div>
      </div>
      <div class="card">
        <div class="label" id="labelMonth">–ú–µ—Å—è—Ü</div>
        <div class="value" id="sumMonth">0</div>
      </div>
      <div class="card">
        <div class="label" id="labelYear">–ì–æ–¥</div>
        <div class="value" id="sumYear">0</div>
      </div>
    </div>

    <button id="recBtn" class="primary">Start recording</button>
    <div class="status" id="status"></div>

    <div class="viewToggle">
      <button class="viewToggleBtn active" data-view="expenses">Expenses</button>
      <button class="viewToggleBtn" data-view="percentages">Percentages</button>
    </div>

    <div id="list"></div>
  </div>
</div>

<div id="settingsPage" class="page settingsPage">
  <div class="settingsHeader">
    <button class="backBtn" id="backBtn">‚Üê</button>
    <h2 id="settingsTitle">Settings</h2>
  </div>

  <div class="settingItem">
    <div class="settingLabel" id="langLabel">Language</div>
    <select id="langSelect">
      <option value="en">English</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="es">Espa√±ol</option>
      <option value="fr">Fran√ßais</option>
      <option value="de">Deutsch</option>
      <option value="it">Italiano</option>
      <option value="pt">Portugu√™s</option>
      <option value="zh">‰∏≠Êñá</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="ko">ÌïúÍµ≠Ïñ¥</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      <option value="tr">T√ºrk√ße</option>
      <option value="nl">Nederlands</option>
      <option value="pl">Polski</option>
    </select>
  </div>

  <div class="settingItem">
    <div class="settingLabel" id="currencyLabel">Currency</div>
    <button id="currencyBtn">
      <span id="selectedCurrency">USD ‚Äì US Dollar</span>
      <span>‚ñº</span>
    </button>
  </div>
</div>

<div id="actionOverlay" class="overlay">
  <div class="actionMenu">
    <button id="editBtn">‚úèÔ∏è Edit</button>
    <button id="deleteBtn" class="danger">üóëÔ∏è Delete</button>
  </div>
</div>

<div id="editPanel" class="editPanel">
  <div class="editForm">
    <h2>Edit Expense</h2>
    <div class="formGroup">
      <label id="labelEditName">Name</label>
      <input type="text" id="editItem">
    </div>
    <div class="formGroup">
      <label id="labelEditCategory">Category</label>
      <select id="editCategory"></select>
    </div>
    <div class="formGroup">
      <label id="labelEditAmount">Amount</label>
      <input type="number" id="editAmount">
    </div>
    <div class="formGroup">
      <label id="labelEditDate">Date & Time</label>
      <input type="datetime-local" id="editDate">
    </div>
    <div class="formActions">
      <button class="btnCancel" id="cancelEdit">Cancel</button>
      <button class="btnSave" id="saveEdit">Save</button>
    </div>
  </div>
</div>

<div id="chartPanel" class="editPanel">
  <div class="editForm chartView">
    <div class="settingsHeader">
      <button class="backBtn" id="chartBack">‚Üê</button>
      <h2 id="chartTitle">Analytics</h2>
    </div>
    <div id="chartContainer"></div>
  </div>
</div>

<div id="currencySelector" class="currencySelector">
  <div class="currencyPanel">
    <h3 id="currencySelectorTitle">Select Currency</h3>
    <input type="text" id="currencySearch" class="currencySearch" placeholder="Search currency...">
    <div class="currencyList" id="currencyList"></div>
  </div>
</div>

<script>
const KEY='vc-data';
let records=JSON.parse(localStorage.getItem(KEY)||'[]');
let currentDailyView='expenses';

// Currency data
const CURRENCIES=[
  {code:'USD',name:'US Dollar',symbol:'$'},
  {code:'EUR',name:'Euro',symbol:'‚Ç¨'},
  {code:'GBP',name:'British Pound',symbol:'¬£'},
  {code:'JPY',name:'Japanese Yen',symbol:'¬•'},
  {code:'CNY',name:'Chinese Yuan',symbol:'¬•'},
  {code:'RUB',name:'Russian Ruble',symbol:'‚ÇΩ'},
  {code:'INR',name:'Indian Rupee',symbol:'‚Çπ'},
  {code:'AUD',name:'Australian Dollar',symbol:'A$'},
  {code:'CAD',name:'Canadian Dollar',symbol:'C$'},
  {code:'CHF',name:'Swiss Franc',symbol:'Fr'},
  {code:'KRW',name:'South Korean Won',symbol:'‚Ç©'},
  {code:'MXN',name:'Mexican Peso',symbol:'$'},
  {code:'BRL',name:'Brazilian Real',symbol:'R$'},
  {code:'ZAR',name:'South African Rand',symbol:'R'},
  {code:'TRY',name:'Turkish Lira',symbol:'‚Ç∫'},
  {code:'AED',name:'UAE Dirham',symbol:'ÿØ.ÿ•'},
  {code:'SAR',name:'Saudi Riyal',symbol:'Ô∑º'},
  {code:'SGD',name:'Singapore Dollar',symbol:'S$'},
  {code:'HKD',name:'Hong Kong Dollar',symbol:'HK$'},
  {code:'NOK',name:'Norwegian Krone',symbol:'kr'},
  {code:'SEK',name:'Swedish Krona',symbol:'kr'},
  {code:'DKK',name:'Danish Krone',symbol:'kr'},
  {code:'PLN',name:'Polish Zloty',symbol:'z≈Ç'},
  {code:'THB',name:'Thai Baht',symbol:'‡∏ø'},
  {code:'IDR',name:'Indonesian Rupiah',symbol:'Rp'},
  {code:'MYR',name:'Malaysian Ringgit',symbol:'RM'},
  {code:'PHP',name:'Philippine Peso',symbol:'‚Ç±'},
  {code:'CZK',name:'Czech Koruna',symbol:'Kƒç'},
  {code:'ILS',name:'Israeli Shekel',symbol:'‚Ç™'},
  {code:'NZD',name:'New Zealand Dollar',symbol:'NZ$'},
  {code:'HUF',name:'Hungarian Forint',symbol:'Ft'},
  {code:'CLP',name:'Chilean Peso',symbol:'$'},
  {code:'ARS',name:'Argentine Peso',symbol:'$'},
  {code:'COP',name:'Colombian Peso',symbol:'$'},
  {code:'VND',name:'Vietnamese Dong',symbol:'‚Ç´'},
  {code:'EGP',name:'Egyptian Pound',symbol:'¬£'},
  {code:'NGN',name:'Nigerian Naira',symbol:'‚Ç¶'},
  {code:'PKR',name:'Pakistani Rupee',symbol:'‚Ç®'},
  {code:'BDT',name:'Bangladeshi Taka',symbol:'‡ß≥'},
  {code:'UAH',name:'Ukrainian Hryvnia',symbol:'‚Ç¥'},
  {code:'KZT',name:'Kazakhstani Tenge',symbol:'‚Ç∏'},
  {code:'RON',name:'Romanian Leu',symbol:'lei'},
  {code:'BGN',name:'Bulgarian Lev',symbol:'–ª–≤'},
  {code:'HRK',name:'Croatian Kuna',symbol:'kn'},
  {code:'QAR',name:'Qatari Riyal',symbol:'Ô∑º'},
  {code:'KWD',name:'Kuwaiti Dinar',symbol:'ÿØ.ŸÉ'},
  {code:'BHD',name:'Bahraini Dinar',symbol:'ÿØ.ÿ®'},
  {code:'OMR',name:'Omani Rial',symbol:'Ô∑º'},
  {code:'JOD',name:'Jordanian Dinar',symbol:'ÿØ.ÿß'},
  {code:'LBP',name:'Lebanese Pound',symbol:'ŸÑ.ŸÑ'}
];

let currentCurrency=localStorage.getItem('currency')||'USD';

function getCurrencySymbol(){
  const curr=CURRENCIES.find(c=>c.code===currentCurrency);
  return curr?curr.symbol:'$';
}

function getCurrencyDisplay(){
  const curr=CURRENCIES.find(c=>c.code===currentCurrency);
  return curr?`${curr.code} ‚Äì ${curr.name}`:'USD ‚Äì US Dollar';
}

// Category system - structured like file-based data
const CATEGORIES={
  food:{
    id:'food',
    name:'Food & Drinks',
    emoji:'üçî',
    color:'#FF6B6B',
    keywords:['–∫–æ—Ñ–µ','–ª–∞—Ç—Ç–µ','–∫–∞–ø—É—á–∏–Ω–æ','–µ–¥–∞','–ø–∏—Ü—Ü–∞','—à–∞—É—Ä–º–∞','—Ä–µ—Å—Ç–æ—Ä–∞–Ω','–±—É—Ä–≥–µ—Ä','–º–∞–∫–¥–æ–Ω–∞–ª—å–¥—Å','–∫—Ñ—Å','—Å—Ç–∞—Ä–±–∞–∫—Å','–∫–∞—Ñ–µ','–æ–±–µ–¥','—É–∂–∏–Ω','–∑–∞–≤—Ç—Ä–∞–∫','–ø–µ—Ä–µ–∫—É—Å','–ø—Ä–æ–¥—É–∫—Ç—ã','grocery','coffee','food','pizza','burger','restaurant','lunch','dinner','breakfast'],
    aliases:['starbucks','mcdonalds','kfc','dunkin','subway','burger king']
  },
  transport:{
    id:'transport',
    name:'Transport',
    emoji:'üöï',
    color:'#4ECDC4',
    keywords:['—Ç–∞–∫—Å–∏','–º–µ—Ç—Ä–æ','–∞–≤—Ç–æ–±—É—Å','—Ç—Ä–∞–º–≤–∞–π','–º–∞—Ä—à—Ä—É—Ç–∫–∞','—è–Ω–¥–µ–∫—Å','—É–±–µ—Ä','taxi','uber','yandex','bus','metro','transport','–ø–æ–µ–∑–¥–∫–∞','–±–∏–ª–µ—Ç','–ø—Ä–æ–µ–∑–¥'],
    aliases:['uber','yandex taxi','bolt','gett']
  },
  home:{
    id:'home',
    name:'Home & Utilities',
    emoji:'üè†',
    color:'#95E1D3',
    keywords:['–∫–≤–∞—Ä—Ç–∏—Ä–∞','–¥–æ–º','–∞—Ä–µ–Ω–¥–∞','–∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ','—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ','–≥–∞–∑','–≤–æ–¥–∞','–∏–Ω—Ç–µ—Ä–Ω–µ—Ç','—Ç–µ–ª–µ—Ñ–æ–Ω','—Å–≤—è–∑—å','rent','utilities','electricity','water','internet','phone','home'],
    aliases:[]
  },
  health:{
    id:'health',
    name:'Health & Fitness',
    emoji:'üíä',
    color:'#F38181',
    keywords:['–∞–ø—Ç–µ–∫–∞','–ª–µ–∫–∞—Ä—Å—Ç–≤–æ','–≤—Ä–∞—á','–±–æ–ª—å–Ω–∏—Ü–∞','–≤–∏—Ç–∞–º–∏–Ω—ã','—Å–ø–æ—Ä—Ç–∑–∞–ª','—Ñ–∏—Ç–Ω–µ—Å','doctor','pharmacy','medicine','hospital','gym','fitness','health'],
    aliases:[]
  },
  entertainment:{
    id:'entertainment',
    name:'Entertainment',
    emoji:'üé¨',
    color:'#AA96DA',
    keywords:['–∫–∏–Ω–æ','—Ç–µ–∞—Ç—Ä','–∫–æ–Ω—Ü–µ—Ä—Ç','—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è','–∏–≥—Ä—ã','–ø–æ–¥–ø–∏—Å–∫–∞','netflix','spotify','cinema','movie','theater','concert','entertainment','subscription','games'],
    aliases:['netflix','spotify','youtube','steam','playstation']
  },
  shopping:{
    id:'shopping',
    name:'Shopping',
    emoji:'üõçÔ∏è',
    color:'#FCBAD3',
    keywords:['–æ–¥–µ–∂–¥–∞','–æ–±—É–≤—å','–º–∞–≥–∞–∑–∏–Ω','–ø–æ–∫—É–ø–∫–∏','—à–æ–ø–ø–∏–Ω–≥','clothes','shoes','shopping','store','mall','clothing'],
    aliases:['zara','h&m','ikea','ozon','wildberries']
  },
  travel:{
    id:'travel',
    name:'Travel',
    emoji:'‚úàÔ∏è',
    color:'#A8D8EA',
    keywords:['–æ—Ç–µ–ª—å','–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞','–∞–≤–∏–∞–±–∏–ª–µ—Ç','–ø–æ–µ–∑–¥','—Å–∞–º–æ–ª–µ—Ç','–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ','–æ—Ç–ø—É—Å–∫','hotel','flight','train','plane','travel','vacation','ticket'],
    aliases:['booking','airbnb','aviasales']
  },
  finance:{
    id:'finance',
    name:'Finance & Fees',
    emoji:'üí≥',
    color:'#FFD93D',
    keywords:['–±–∞–Ω–∫','–∫–æ–º–∏—Å—Å–∏—è','–ø–µ—Ä–µ–≤–æ–¥','–Ω–∞–ª–æ–≥','—à—Ç—Ä–∞—Ñ','—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞','bank','fee','transfer','tax','fine','insurance','commission'],
    aliases:[]
  },
  education:{
    id:'education',
    name:'Education',
    emoji:'üìö',
    color:'#6BCB77',
    keywords:['–∫—É—Ä—Å—ã','–æ–±—É—á–µ–Ω–∏–µ','–∫–Ω–∏–≥–∏','–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ','—à–∫–æ–ª–∞','—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç','course','education','books','school','university','learning'],
    aliases:['udemy','coursera','skillbox']
  },
  uncategorized:{
    id:'uncategorized',
    name:'Uncategorized',
    emoji:'‚ö™',
    color:'#9a9ab3',
    keywords:[],
    aliases:[]
  }
};

// Build icon mapping from categories
const ICONS={};
Object.values(CATEGORIES).forEach(cat=>{
  ICONS[cat.name]=cat.emoji;
  // Support both English and localized names
  ICONS[cat.id]=cat.emoji;
});

// Auto-detect category based on keywords
function detectCat(text){
  if(!text) return CATEGORIES.uncategorized.name;

  text=text.toLowerCase();

  // Try to match keywords in each category
  for(const cat of Object.values(CATEGORIES)){
    if(cat.id==='uncategorized') continue;

    // Check keywords
    for(const keyword of cat.keywords){
      if(text.includes(keyword.toLowerCase())){
        return cat.name;
      }
    }

    // Check aliases
    for(const alias of cat.aliases){
      if(text.includes(alias.toLowerCase())){
        return cat.name;
      }
    }
  }

  return CATEGORIES.uncategorized.name;
}

function today(){
 return new Date().toISOString().slice(0,10);
}

function formatAmount(amount){
 // Format amount without unnecessary decimals
 // If integer, show without decimals; if decimal, show without trailing zeros
 let num;
 if(Number.isInteger(amount)){
  num=amount.toString();
 }else{
  // Remove trailing zeros after decimal point
  num=amount.toString().replace(/\.?0+$/,'');
 }
 return `${getCurrencySymbol()}${num}`;
}

function render(){
 let t=0,m=0,y=0;
 const list=document.getElementById('list');
 const todayStr=today();
 list.innerHTML='';

 // Check current view mode
 if(currentDailyView==='percentages'){
  renderDailyPercentages();
  // Still calculate totals
  records.forEach(r=>{
   const recDate=r.date.slice(0,10);
   if(recDate===todayStr) t+=r.amount;
   if(recDate.slice(0,7)===todayStr.slice(0,7)) m+=r.amount;
   if(recDate.slice(0,4)===todayStr.slice(0,4)) y+=r.amount;
  });
 } else {
  // Expenses view (default)
  records.forEach(r=>{
   const recDate=r.date.slice(0,10);
   if(recDate===todayStr){
    t+=r.amount;
    const row=document.createElement('div');
    row.className='record';
    row.innerHTML=`
     <div class="icon">${ICONS[r.category]||'‚ùì'}</div>
     <div class="recMain">
       <div class="recTitle">${r.item}</div>
       <div class="recMeta">${r.category}</div>
     </div>
     <div class="recRight">
       <div class="amount">${formatAmount(r.amount)}</div>
       <button class="menuBtn" data-id="${r.id}">‚ãÆ</button>
     </div>`;
    list.appendChild(row);
    row.querySelector('.menuBtn').onclick=()=>openActionMenu(r.id);
   }
   if(recDate.slice(0,7)===todayStr.slice(0,7)) m+=r.amount;
   if(recDate.slice(0,4)===todayStr.slice(0,4)) y+=r.amount;
  });
 }

 document.getElementById('sumToday').textContent=formatAmount(t);
 document.getElementById('sumMonth').textContent=formatAmount(m);
 document.getElementById('sumYear').textContent=formatAmount(y);
}

function renderDailyPercentages(){
 const list=document.getElementById('list');
 const todayStr=today();
 const categoryTotals={};
 let dayTotal=0;

 // Calculate category totals for today
 records.forEach(r=>{
  const recDate=r.date.slice(0,10);
  if(recDate===todayStr){
   const category=r.category||CATEGORIES.uncategorized.name;
   categoryTotals[category]=(categoryTotals[category]||0)+r.amount;
   dayTotal+=r.amount;
  }
 });

 // Build percentage chart
 if(dayTotal>0){
  const categoryArray=Object.entries(categoryTotals).map(([name,amount])=>{
   const cat=Object.values(CATEGORIES).find(c=>c.name===name)||CATEGORIES.uncategorized;
   return {name,amount,cat};
  }).sort((a,b)=>b.amount-a.amount);

  categoryArray.forEach(({name,amount,cat})=>{
   const percentage=((amount/dayTotal)*100).toFixed(1);
   const bar=document.createElement('div');
   bar.className='categoryBar';
   bar.innerHTML=`
    <div class="categoryBarLabel">
     <span>${cat.emoji} ${name}</span>
     <span>${formatAmount(amount)} (${percentage}%)</span>
    </div>
    <div class="categoryBarTrack">
     <div class="categoryBarFill" style="width:${percentage}%;background:${cat.color}"></div>
    </div>`;
   list.appendChild(bar);
  });
 } else {
  // No expenses today
  list.innerHTML='<p style="text-align:center;color:var(--muted);padding:40px 20px;">No expenses recorded for today</p>';
 }
}

let rec,isRec=false;
const btn=document.getElementById('recBtn');

function stopRecording(){
 isRec=false;
 btn.classList.remove('recording');
 const t=translations[currentLang]||translations.en;
 btn.textContent=t.recBtn;
}

btn.onclick=()=>{
 if(isRec){
  rec.stop();
  return;
 }
 rec=new webkitSpeechRecognition();
 const langCodes={en:'en-US',ru:'ru-RU',es:'es-ES',fr:'fr-FR',de:'de-DE',it:'it-IT',pt:'pt-PT',zh:'zh-CN',ja:'ja-JP',ko:'ko-KR',ar:'ar-SA',hi:'hi-IN',tr:'tr-TR',nl:'nl-NL',pl:'pl-PL'};
 rec.lang=langCodes[currentLang]||'en-US';
 rec.onresult=e=>{
  let t=e.results[0][0].transcript;
  if(!t) return;

  // Convert number words to digits
  const numberWords={
   ru:{
    '–Ω–æ–ª—å':0,'–æ–¥–∏–Ω':1,'–æ–¥–Ω–∞':1,'–¥–≤–∞':2,'–¥–≤–µ':2,'—Ç—Ä–∏':3,'—á–µ—Ç—ã—Ä–µ':4,'–ø—è—Ç—å':5,'—à–µ—Å—Ç—å':6,'—Å–µ–º—å':7,'–≤–æ—Å–µ–º—å':8,'–¥–µ–≤—è—Ç—å':9,
    '–¥–µ—Å—è—Ç—å':10,'–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å':11,'–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å':12,'—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å':13,'—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å':14,'–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å':15,'—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å':16,'—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å':17,'–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å':18,'–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å':19,
    '–¥–≤–∞–¥—Ü–∞—Ç—å':20,'—Ç—Ä–∏–¥—Ü–∞—Ç—å':30,'—Å–æ—Ä–æ–∫':40,'–ø—è—Ç—å–¥–µ—Å—è—Ç':50,'—à–µ—Å—Ç—å–¥–µ—Å—è—Ç':60,'—Å–µ–º—å–¥–µ—Å—è—Ç':70,'–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç':80,'–¥–µ–≤—è–Ω–æ—Å—Ç–æ':90,
    '—Å—Ç–æ':100,'–¥–≤–µ—Å—Ç–∏':200,'—Ç—Ä–∏—Å—Ç–∞':300,'—á–µ—Ç—ã—Ä–µ—Å—Ç–∞':400,'–ø—è—Ç—å—Å–æ—Ç':500,'—à–µ—Å—Ç—å—Å–æ—Ç':600,'—Å–µ–º—å—Å–æ—Ç':700,'–≤–æ—Å–µ–º—å—Å–æ—Ç':800,'–¥–µ–≤—è—Ç—å—Å–æ—Ç':900,
    '—Ç—ã—Å—è—á–∞':1000,'—Ç—ã—Å—è—á–∏':1000,'—Ç—ã—Å—è—á':1000,'–º–∏–ª–ª–∏–æ–Ω':1000000,'–º–∏–ª–ª–∏–æ–Ω–∞':1000000,'–º–∏–ª–ª–∏–æ–Ω–æ–≤':1000000
   },
   en:{
    'zero':0,'one':1,'two':2,'three':3,'four':4,'five':5,'six':6,'seven':7,'eight':8,'nine':9,
    'ten':10,'eleven':11,'twelve':12,'thirteen':13,'fourteen':14,'fifteen':15,'sixteen':16,'seventeen':17,'eighteen':18,'nineteen':19,
    'twenty':20,'thirty':30,'forty':40,'fifty':50,'sixty':60,'seventy':70,'eighty':80,'ninety':90,
    'hundred':100,'thousand':1000,'million':1000000
   },
   es:{
    'cero':0,'uno':1,'una':1,'dos':2,'tres':3,'cuatro':4,'cinco':5,'seis':6,'siete':7,'ocho':8,'nueve':9,
    'diez':10,'once':11,'doce':12,'trece':13,'catorce':14,'quince':15,'diecis√©is':16,'diecisiete':17,'dieciocho':18,'diecinueve':19,
    'veinte':20,'treinta':30,'cuarenta':40,'cincuenta':50,'sesenta':60,'setenta':70,'ochenta':80,'noventa':90,
    'cien':100,'ciento':100,'doscientos':200,'trescientos':300,'cuatrocientos':400,'quinientos':500,'seiscientos':600,'setecientos':700,'ochocientos':800,'novecientos':900,
    'mil':1000,'mill√≥n':1000000
   }
  };

  const dict=numberWords[currentLang]||numberWords.en;
  const words=t.toLowerCase().split(/\s+/);
  let total=0;
  let current=0;
  let foundNumber=false;
  let firstNumberIndex=-1;

  for(let i=0;i<words.length;i++){
   const word=words[i].replace(/[.,!?]/g,'');
   let val=undefined;

   // Check if it's a number word in dictionary
   if(dict[word]!==undefined){
    val=dict[word];
   }
   // Also check if it's a digit string (like "5", "500", etc.)
   else if(/^\d+$/.test(word)){
    val=parseInt(word,10);
   }

   if(val!==undefined){
    if(firstNumberIndex===-1) firstNumberIndex=i;
    foundNumber=true;

    if(val>=1000000){
     total+=(current||1)*val;
     current=0;
    }else if(val>=1000){
     total+=(current||1)*val;
     current=0;
    }else if(val>=100){
     current=(current||1)*val;
    }else{
     current+=val;
    }
   }else if(foundNumber){
    break;
   }
  }

  if(foundNumber && firstNumberIndex>=0){
   total+=current;
   if(total>0){
    t=words.slice(0,firstNumberIndex).join(' ')+' '+total;
   }
  }

  const m=t.match(/(.+)\s+(\d+(?:[.,]\d+)?)$/);
  if(!m) return;
  records.unshift({
   id:crypto.randomUUID(),
   item:m[1].trim(),
   amount:+m[2].replace(',','.'),
   category:detectCat(m[1]),
   date:new Date().toISOString()
  });
  localStorage.setItem(KEY,JSON.stringify(records));
  render();
 };
 rec.onend=stopRecording;
 rec.start();
 isRec=true;
 btn.classList.add('recording');
 const t=translations[currentLang]||translations.en;
 btn.textContent=t.recBtnActive;
};

// action menu & edit logic
let currentRecordId=null;
const actionOverlay=document.getElementById('actionOverlay');
const editPanel=document.getElementById('editPanel');

function openActionMenu(id){
 currentRecordId=id;
 actionOverlay.classList.add('show');
}

function closeActionMenu(){
 actionOverlay.classList.remove('show');
 // Don't reset currentRecordId here - we need it for edit panel
}

function deleteRecord(){
 records=records.filter(r=>r.id!==currentRecordId);
 localStorage.setItem(KEY,JSON.stringify(records));
 closeActionMenu();
 currentRecordId=null;
 if(currentChartType && selectedPeriod){
  if(currentChartType==='month') showMonthChart();
  else if(currentChartType==='year') showYearChart();
 }else{
  render();
 }
}

function openEditPanel(){
 const record=records.find(r=>r.id===currentRecordId);
 if(!record){
  closeActionMenu();
  return;
 }

 // Populate form fields
 document.getElementById('editItem').value=record.item;
 document.getElementById('editAmount').value=record.amount;

 // Populate category dropdown with emoji + name
 const categorySelect=document.getElementById('editCategory');
 categorySelect.innerHTML='';

 Object.values(CATEGORIES).forEach(cat=>{
  const option=document.createElement('option');
  option.value=cat.name;
  option.textContent=`${cat.emoji} ${cat.name}`;
  if(cat.name===record.category){
   option.selected=true;
  }
  categorySelect.appendChild(option);
 });

 // Handle date format for datetime-local input
 let dateValue=record.date;
 if(dateValue){
  if(dateValue.includes('T')){
   // Already has time, use as is
   dateValue=dateValue.slice(0,16); // Format: YYYY-MM-DDTHH:MM
  }else{
   // Just date, add default time
   dateValue+='T12:00';
  }
 }
 document.getElementById('editDate').value=dateValue;

 closeActionMenu();
 editPanel.classList.add('show');
}

function closeEditPanel(){
 editPanel.classList.remove('show');
 currentRecordId=null;
}

function saveEdit(){
 // Find the record
 const record=records.find(r=>r.id===currentRecordId);
 if(!record){
  alert('Error: Record not found');
  closeEditPanel();
  return;
 }

 // Get form values
 const itemInput=document.getElementById('editItem');
 const categoryInput=document.getElementById('editCategory');
 const amountInput=document.getElementById('editAmount');
 const dateInput=document.getElementById('editDate');

 const itemVal=itemInput.value.trim();
 const catVal=categoryInput.value.trim();
 const amountVal=parseFloat(amountInput.value);
 const dateVal=dateInput.value;

 // Validate
 if(!itemVal || !catVal || !amountVal || amountVal<=0 || !dateVal){
  alert('Please fill all fields with valid values');
  return;
 }

 // Update record
 record.item=itemVal;
 record.category=catVal;
 record.amount=amountVal;

 // Convert datetime-local to ISO string
 if(dateVal.includes('T')){
  const dt=new Date(dateVal);
  record.date=dt.toISOString();
 }else{
  record.date=dateVal;
 }

 // Save to localStorage
 localStorage.setItem(KEY,JSON.stringify(records));

 // Close panel
 closeEditPanel();

 // Refresh view
 if(currentChartType && selectedPeriod){
  if(currentChartType==='month') showMonthChart();
  else if(currentChartType==='year') showYearChart();
 }else{
  render();
 }
}

// event listeners
actionOverlay.onclick=(e)=>{
 if(e.target===actionOverlay){
  closeActionMenu();
  currentRecordId=null;
 }
};
document.getElementById('editBtn').onclick=openEditPanel;
document.getElementById('deleteBtn').onclick=deleteRecord;
editPanel.onclick=(e)=>{
 if(e.target===editPanel) closeEditPanel();
};
document.getElementById('cancelEdit').onclick=(e)=>{
 e.stopPropagation();
 closeEditPanel();
};
document.getElementById('saveEdit').onclick=(e)=>{
 e.stopPropagation();
 saveEdit();
};

// charts
const chartPanel=document.getElementById('chartPanel');
let currentChartType=null;
let selectedPeriod=null;
let displayedYear=new Date().getFullYear();
let displayedMonth=new Date().getMonth();
let currentMonthlyView='expenses';
let currentYearlyView='expenses';

function openChart(type){
 currentChartType=type;
 chartPanel.classList.add('show');
 if(type==='month'){
  displayedYear=new Date().getFullYear();
  displayedMonth=new Date().getMonth();
  showMonthChart();
 }else if(type==='year'){
  displayedYear=new Date().getFullYear();
  showYearChart();
 }
}

function closeChart(){
 chartPanel.classList.remove('show');
 currentChartType=null;
 selectedPeriod=null;
}

document.getElementById('chartBack').onclick=closeChart;
chartPanel.onclick=(e)=>{
 if(e.target===chartPanel) closeChart();
};

function getMonthName(monthIndex){
 const monthNames={
  en:['January','February','March','April','May','June','July','August','September','October','November','December'],
  ru:['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'],
  es:['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],
  fr:['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'],
  de:['Januar','Februar','M√§rz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'],
  it:['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],
  pt:['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
  zh:['‰∏ÄÊúà','‰∫åÊúà','‰∏âÊúà','ÂõõÊúà','‰∫îÊúà','ÂÖ≠Êúà','‰∏ÉÊúà','ÂÖ´Êúà','‰πùÊúà','ÂçÅÊúà','ÂçÅ‰∏ÄÊúà','ÂçÅ‰∫åÊúà'],
  ja:['1Êúà','2Êúà','3Êúà','4Êúà','5Êúà','6Êúà','7Êúà','8Êúà','9Êúà','10Êúà','11Êúà','12Êúà'],
  ko:['1Ïõî','2Ïõî','3Ïõî','4Ïõî','5Ïõî','6Ïõî','7Ïõî','8Ïõî','9Ïõî','10Ïõî','11Ïõî','12Ïõî'],
  ar:['ŸäŸÜÿßŸäÿ±','ŸÅÿ®ÿ±ÿßŸäÿ±','ŸÖÿßÿ±ÿ≥','ÿ£ÿ®ÿ±ŸäŸÑ','ŸÖÿßŸäŸà','ŸäŸàŸÜŸäŸà','ŸäŸàŸÑŸäŸà','ÿ£ÿ∫ÿ≥ÿ∑ÿ≥','ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±','ÿ£ŸÉÿ™Ÿàÿ®ÿ±','ŸÜŸàŸÅŸÖÿ®ÿ±','ÿØŸäÿ≥ŸÖÿ®ÿ±'],
  hi:['‡§ú‡§®‡§µ‡§∞‡•Ä','‡§´‡§º‡§∞‡§µ‡§∞‡•Ä','‡§Æ‡§æ‡§∞‡•ç‡§ö','‡§Ö‡§™‡•ç‡§∞‡•à‡§≤','‡§Æ‡§à','‡§ú‡•Ç‡§®','‡§ú‡•Å‡§≤‡§æ‡§à','‡§Ö‡§ó‡§∏‡•ç‡§§','‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞','‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞','‡§®‡§µ‡§Ç‡§¨‡§∞','‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞'],
  tr:['Ocak','≈ûubat','Mart','Nisan','Mayƒ±s','Haziran','Temmuz','Aƒüustos','Eyl√ºl','Ekim','Kasƒ±m','Aralƒ±k'],
  nl:['Januari','Februari','Maart','April','Mei','Juni','Juli','Augustus','September','Oktober','November','December'],
  pl:['Stycze≈Ñ','Luty','Marzec','Kwiecie≈Ñ','Maj','Czerwiec','Lipiec','Sierpie≈Ñ','Wrzesie≈Ñ','Pa≈∫dziernik','Listopad','Grudzie≈Ñ']
 };
 const names=monthNames[currentLang]||monthNames.en;
 return names[monthIndex];
}

function prevMonth(){
 displayedMonth--;
 if(displayedMonth<0){
  displayedMonth=11;
  displayedYear--;
 }
 showMonthChart();
}

function nextMonth(){
 displayedMonth++;
 if(displayedMonth>11){
  displayedMonth=0;
  displayedYear++;
 }
 showMonthChart();
}

function prevYear(){
 displayedYear--;
 showYearChart();
}

function nextYear(){
 displayedYear++;
 showYearChart();
}

function showMonthChart(){
 const now=new Date();
 const currentYear=now.getFullYear();
 const currentMonth=now.getMonth();
 const todayDate=today();

 const daysInMonth=new Date(displayedYear,displayedMonth+1,0).getDate();
 const isCurrentMonth=(displayedYear===currentYear && displayedMonth===currentMonth);

 const monthYearText=`${getMonthName(displayedMonth)} ${displayedYear}`;

 // Build daily totals
 const dailyTotals={};
 const daysWithExpenses=[];

 for(let d=1;d<=daysInMonth;d++){
  const date=`${displayedYear}-${String(displayedMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  dailyTotals[date]=0;
 }

 // Build category totals
 const categoryTotals={};
 let monthTotal=0;

 records.forEach(r=>{
  const recDate=r.date.slice(0,10);
  if(recDate.startsWith(`${displayedYear}-${String(displayedMonth+1).padStart(2,'0')}`)){
   dailyTotals[recDate]=(dailyTotals[recDate]||0)+r.amount;
   if(!daysWithExpenses.includes(recDate)){
    daysWithExpenses.push(recDate);
   }

   // Track category totals
   const category=r.category||CATEGORIES.uncategorized.name;
   categoryTotals[category]=(categoryTotals[category]||0)+r.amount;
   monthTotal+=r.amount;
  }
 });

 const values=Object.values(dailyTotals);
 const maxVal=Math.max(...values,1);

 // Determine auto-selected day
 let autoSelectedDate;
 if(isCurrentMonth){
  autoSelectedDate=todayDate;
 }else if(daysWithExpenses.length>0){
  daysWithExpenses.sort();
  autoSelectedDate=daysWithExpenses[daysWithExpenses.length-1];
 }else{
  const lastDay=`${displayedYear}-${String(displayedMonth+1).padStart(2,'0')}-${String(daysInMonth).padStart(2,'0')}`;
  autoSelectedDate=lastDay;
 }

 // Build HTML
 let chartHTML=`
  <div class="monthHeader">
   <button class="monthNav" onclick="prevMonth()">‚Üê</button>
   <div class="monthTitle">${monthYearText}</div>
   <button class="monthNav" onclick="nextMonth()">‚Üí</button>
  </div>
  <div class="viewToggle">
   <button class="viewToggleBtn ${currentMonthlyView==='expenses'?'active':''}" data-view="expenses" data-context="monthly">Expenses</button>
   <button class="viewToggleBtn ${currentMonthlyView==='percentages'?'active':''}" data-view="percentages" data-context="monthly">Percentages</button>
  </div>
  <div class="view-content" id="monthlyViewContent">`;

 if(currentMonthlyView==='expenses'){
  // Expenses view: Show daily bar chart + expense list
  chartHTML+=`<div class="chartScroll" style="padding-bottom:30px;"><div class="chart">`;
  for(let d=1;d<=daysInMonth;d++){
   const date=`${displayedYear}-${String(displayedMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
   const val=dailyTotals[date];
   const height=(val/maxVal)*100;
   const isSelected=date===autoSelectedDate?'selected':'';
   chartHTML+=`<div class="bar ${isSelected}" style="height:${height}%" data-date="${date}"><div class="barLabel">${d}</div></div>`;
  }
  chartHTML+='</div></div>';
  chartHTML+='<div id="expenseList" class="expenseList"></div>';
 }else{
  // Percentages view: Show category breakdown
  if(monthTotal>0){
   chartHTML+=`<div class="categoryChart" style="margin-top:0;"><h4 style="margin:16px 0 12px;font-size:14px;color:var(--muted);">Category Breakdown</h4>`;

   // Sort categories by amount (highest first)
   const categoryArray=Object.entries(categoryTotals).map(([name,amount])=>{
    const cat=Object.values(CATEGORIES).find(c=>c.name===name)||CATEGORIES.uncategorized;
    return {name,amount,cat};
   }).sort((a,b)=>b.amount-a.amount);

   categoryArray.forEach(({name,amount,cat})=>{
    const percentage=((amount/monthTotal)*100).toFixed(1);
    chartHTML+=`
     <div class="categoryBar" data-category="${name}">
      <div class="categoryBarLabel">
       <span>${cat.emoji} ${name}</span>
       <span>${formatAmount(amount)} (${percentage}%)</span>
      </div>
      <div class="categoryBarTrack">
       <div class="categoryBarFill" style="width:${percentage}%;background:${cat.color}"></div>
      </div>
     </div>`;
   });

   chartHTML+='</div>';
  }else{
   chartHTML+=`<p style="text-align:center;color:var(--muted);padding:40px 20px;">No expenses for this month</p>`;
  }
  chartHTML+='<div id="expenseList" class="expenseList"></div>';
 }

 chartHTML+='</div>';

 // Insert HTML
 const container=document.getElementById('chartContainer');
 container.innerHTML=chartHTML;

 // Attach toggle event handlers
 const toggleBtns=container.querySelectorAll('.viewToggleBtn[data-context="monthly"]');
 toggleBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
   const newView=btn.getAttribute('data-view');
   if(newView!==currentMonthlyView){
    const oldView=currentMonthlyView;
    currentMonthlyView=newView;

    // Determine animation direction
    const viewContent=document.getElementById('monthlyViewContent');
    viewContent.classList.remove('slide-left','slide-right');

    if(oldView==='expenses' && newView==='percentages'){
     viewContent.classList.add('slide-left');
    }else if(oldView==='percentages' && newView==='expenses'){
     viewContent.classList.add('slide-right');
    }

    showMonthChart();
   }
  });
 });

 if(currentMonthlyView==='expenses'){
  // Attach event handlers to each bar individually
  const bars=container.querySelectorAll('.bar');
  bars.forEach(bar=>{
   const selectBar=()=>{
    bars.forEach(b=>b.classList.remove('selected'));
    bar.classList.add('selected');
    const date=bar.getAttribute('data-date');
    selectedPeriod=date;
    showExpensesForDate(date);
   };

   bar.addEventListener('click',selectBar);
   bar.addEventListener('touchend',(e)=>{
    e.preventDefault();
    selectBar();
   });
  });

  // Show initial data
  selectedPeriod=autoSelectedDate;
  showExpensesForDate(autoSelectedDate);

  // Scroll to selected bar
  setTimeout(()=>{
   const selectedBar=container.querySelector('.bar.selected');
   if(selectedBar){
    selectedBar.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
   }
  },100);
 }else{
  // Attach event handlers to category bars in percentages view
  const categoryBars=container.querySelectorAll('.categoryBar');
  categoryBars.forEach(catBar=>{
   const selectCategoryBar=()=>{
    const categoryName=catBar.getAttribute('data-category');
    selectedPeriod=`${displayedYear}-${String(displayedMonth+1).padStart(2,'0')}`;
    showCategoryExpenses(categoryName,selectedPeriod);
   };

   catBar.addEventListener('click',selectCategoryBar);
   catBar.addEventListener('touchend',(e)=>{
    e.preventDefault();
    selectCategoryBar();
   });
  });
 }
}

function showYearChart(){
 const now=new Date();
 const currentYear=now.getFullYear();
 const currentMonth=now.getMonth();

 const isCurrentYear=(displayedYear===currentYear);

 const yearText=`${displayedYear}`;

 const monthlyTotals={};
 const monthsWithExpenses=[];
 const categoryTotals={};
 let yearTotal=0;
 const monthNames=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

 for(let m=0;m<12;m++){
  const prefix=`${displayedYear}-${String(m+1).padStart(2,'0')}`;
  monthlyTotals[prefix]=0;
 }

 records.forEach(r=>{
  const recDate=r.date.slice(0,10);
  const prefix=recDate.slice(0,7);
  if(recDate.startsWith(String(displayedYear))){
   monthlyTotals[prefix]=(monthlyTotals[prefix]||0)+r.amount;
   if(monthlyTotals[prefix]>0 && !monthsWithExpenses.includes(prefix)){
    monthsWithExpenses.push(prefix);
   }

   // Track category totals for the year
   const category=r.category||CATEGORIES.uncategorized.name;
   categoryTotals[category]=(categoryTotals[category]||0)+r.amount;
   yearTotal+=r.amount;
  }
 });

 const values=Object.values(monthlyTotals);
 const maxVal=Math.max(...values,1);

 // Determine auto-selected month
 let autoSelectedMonth;
 if(isCurrentYear){
  autoSelectedMonth=`${displayedYear}-${String(currentMonth+1).padStart(2,'0')}`;
 }else if(monthsWithExpenses.length>0){
  // Find month with highest expenses
  let maxExpense=0;
  let maxMonth='';
  monthsWithExpenses.forEach(m=>{
   if(monthlyTotals[m]>maxExpense){
    maxExpense=monthlyTotals[m];
    maxMonth=m;
   }
  });
  autoSelectedMonth=maxMonth;
 }else{
  autoSelectedMonth=`${displayedYear}-${String(currentMonth+1).padStart(2,'0')}`;
 }

 let chartHTML=`
  <div class="monthHeader">
   <button class="monthNav" onclick="prevYear()">‚Üê</button>
   <div class="monthTitle">${yearText}</div>
   <button class="monthNav" onclick="nextYear()">‚Üí</button>
  </div>
  <div class="viewToggle">
   <button class="viewToggleBtn ${currentYearlyView==='expenses'?'active':''}" data-view="expenses" data-context="yearly">Expenses</button>
   <button class="viewToggleBtn ${currentYearlyView==='percentages'?'active':''}" data-view="percentages" data-context="yearly">Percentages</button>
  </div>
  <div class="view-content" id="yearlyViewContent">`;

 if(currentYearlyView==='expenses'){
  // Expenses view: Show monthly bar chart + expense list
  chartHTML+=`<div class="chartScroll" style="padding-bottom:30px;"><div class="chart">`;
  for(let m=0;m<12;m++){
   const prefix=`${displayedYear}-${String(m+1).padStart(2,'0')}`;
   const val=monthlyTotals[prefix];
   const height=(val/maxVal)*100;
   const isSelected=prefix===autoSelectedMonth?'selected':'';
   chartHTML+=`<div class="bar ${isSelected}" style="height:${height}%" data-month="${prefix}"><div class="barLabel">${monthNames[m]}</div></div>`;
  }
  chartHTML+='</div></div>';
  chartHTML+='<div id="expenseList" class="expenseList"></div>';
 }else{
  // Percentages view: Show category breakdown for the year
  if(yearTotal>0){
   chartHTML+=`<div class="categoryChart" style="margin-top:0;"><h4 style="margin:16px 0 12px;font-size:14px;color:var(--muted);">Category Breakdown</h4>`;

   const categoryArray=Object.entries(categoryTotals).map(([name,amount])=>{
    const cat=Object.values(CATEGORIES).find(c=>c.name===name)||CATEGORIES.uncategorized;
    return {name,amount,cat};
   }).sort((a,b)=>b.amount-a.amount);

   categoryArray.forEach(({name,amount,cat})=>{
    const percentage=((amount/yearTotal)*100).toFixed(1);
    chartHTML+=`
     <div class="categoryBar" data-category="${name}" data-year-category="true">
      <div class="categoryBarLabel">
       <span>${cat.emoji} ${name}</span>
       <span>${formatAmount(amount)} (${percentage}%)</span>
      </div>
      <div class="categoryBarTrack">
       <div class="categoryBarFill" style="width:${percentage}%;background:${cat.color}"></div>
      </div>
     </div>`;
   });

   chartHTML+='</div>';
  }else{
   chartHTML+=`<p style="text-align:center;color:var(--muted);padding:40px 20px;">No expenses for this year</p>`;
  }
  chartHTML+='<div id="expenseList" class="expenseList"></div>';
 }

 chartHTML+='</div>';

 const container=document.getElementById('chartContainer');
 container.innerHTML=chartHTML;

 // Attach toggle event handlers
 const toggleBtns=container.querySelectorAll('.viewToggleBtn[data-context="yearly"]');
 toggleBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
   const newView=btn.getAttribute('data-view');
   if(newView!==currentYearlyView){
    const oldView=currentYearlyView;
    currentYearlyView=newView;

    // Determine animation direction
    const viewContent=document.getElementById('yearlyViewContent');
    viewContent.classList.remove('slide-left','slide-right');

    if(oldView==='expenses' && newView==='percentages'){
     viewContent.classList.add('slide-left');
    }else if(oldView==='percentages' && newView==='expenses'){
     viewContent.classList.add('slide-right');
    }

    showYearChart();
   }
  });
 });

 if(currentYearlyView==='expenses'){
  // Attach click handler for bar chart
  const handleBarSelect=(e)=>{
   const bar=e.target.closest('.bar');
   if(bar && bar.dataset.month){
    e.preventDefault();
    e.stopPropagation();
    container.querySelectorAll('.bar').forEach(b=>b.classList.remove('selected'));
    bar.classList.add('selected');
    const monthPrefix=bar.dataset.month;
    selectedPeriod=monthPrefix;
    showMonthSummary(monthPrefix);
   }
  };

  container.addEventListener('click',handleBarSelect);
  container.addEventListener('touchend',handleBarSelect);

  selectedPeriod=autoSelectedMonth;
  showMonthSummary(autoSelectedMonth);

  setTimeout(()=>{
   const selectedBar=container.querySelector('.bar.selected');
   if(selectedBar){
    selectedBar.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
   }
  },100);
 }else{
  // Attach event handlers to category bars in percentages view
  const categoryBars=container.querySelectorAll('.categoryBar[data-year-category="true"]');
  categoryBars.forEach(catBar=>{
   const selectCategoryBar=()=>{
    const categoryName=catBar.getAttribute('data-category');
    selectedPeriod=String(displayedYear);
    showYearlyCategoryExpenses(categoryName,displayedYear);
   };

   catBar.addEventListener('click',selectCategoryBar);
   catBar.addEventListener('touchend',(e)=>{
    e.preventDefault();
    selectCategoryBar();
   });
  });
 }
}

function formatDateDisplay(dateStr){
 const parts=dateStr.split('-');
 const year=parseInt(parts[0]);
 const month=parseInt(parts[1])-1;
 const day=parseInt(parts[2]);
 return `${getMonthName(month)} ${day}`;
}

function showExpensesForDate(date){
 const dayRecords=records.filter(r=>r.date.slice(0,10)===date);
 const container=document.getElementById('expenseList');

 if(dayRecords.length===0){
  container.innerHTML='<h4>No expenses on this day</h4>';
  return;
 }

 const dateDisplay=formatDateDisplay(date);
 let html=`<h4>${dateDisplay}</h4>`;
 dayRecords.forEach(r=>{
  html+=`
   <div class="record">
    <div class="icon">${ICONS[r.category]||'‚ùì'}</div>
    <div class="recMain">
     <div class="recTitle">${r.item}</div>
     <div class="recMeta">${r.category}</div>
    </div>
    <div class="recRight">
     <div class="amount">${formatAmount(r.amount)}</div>
     <button class="menuBtn" data-id="${r.id}">‚ãÆ</button>
    </div>
   </div>`;
 });

 container.innerHTML=html;

 container.querySelectorAll('.menuBtn').forEach(btn=>{
  btn.onclick=()=>{
   currentRecordId=btn.dataset.id;
   actionOverlay.classList.add('show');
  };
 });
}

function showCategoryExpenses(categoryName,monthPrefix){
 // Filter records by category and month
 const categoryRecords=records.filter(r=>{
  const recDate=r.date.slice(0,10);
  const recCategory=r.category||CATEGORIES.uncategorized.name;
  return recDate.startsWith(monthPrefix) && recCategory===categoryName;
 });

 const container=document.getElementById('expenseList');

 if(categoryRecords.length===0){
  container.innerHTML=`<h4>${categoryName}</h4><p style="color:var(--muted);margin-top:8px;">No expenses in this category</p>`;
  return;
 }

 // Group by date
 const byDate={};
 categoryRecords.forEach(r=>{
  const date=r.date.slice(0,10);
  if(!byDate[date]) byDate[date]=[];
  byDate[date].push(r);
 });

 const cat=Object.values(CATEGORIES).find(c=>c.name===categoryName)||CATEGORIES.uncategorized;
 let html=`<h4>${cat.emoji} ${categoryName}</h4>`;

 // Sort dates chronologically
 Object.keys(byDate).sort().forEach(date=>{
  const dateDisplay=formatDateDisplay(date);
  const dayRecords=byDate[date];
  const dayTotal=dayRecords.reduce((sum,r)=>sum+r.amount,0);

  html+=`<div style="margin-top:16px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.1);">
   <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
    <span style="font-size:13px;color:var(--muted);">${dateDisplay}</span>
    <span style="font-size:13px;font-weight:600;color:var(--accent);">${formatAmount(dayTotal)}</span>
   </div>`;

  dayRecords.forEach(r=>{
   html+=`
    <div class="record">
     <div class="icon">${cat.emoji}</div>
     <div class="recMain">
      <div class="recTitle">${r.item}</div>
      <div class="recMeta">${new Date(r.date).toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'})}</div>
     </div>
     <div class="recRight">
      <div class="amount">${formatAmount(r.amount)}</div>
      <button class="menuBtn" data-id="${r.id}">‚ãÆ</button>
     </div>
    </div>`;
  });

  html+='</div>';
 });

 container.innerHTML=html;

 container.querySelectorAll('.menuBtn').forEach(btn=>{
  btn.onclick=()=>{
   currentRecordId=btn.dataset.id;
   actionOverlay.classList.add('show');
  };
 });
}

function showYearlyCategoryExpenses(categoryName,year){
 // Filter records by category and year
 const categoryRecords=records.filter(r=>{
  const recDate=r.date.slice(0,10);
  const recCategory=r.category||CATEGORIES.uncategorized.name;
  return recDate.startsWith(String(year)) && recCategory===categoryName;
 });

 const container=document.getElementById('expenseList');

 if(categoryRecords.length===0){
  container.innerHTML=`<h4>${categoryName}</h4><p style="color:var(--muted);margin-top:8px;">No expenses in this category</p>`;
  return;
 }

 // Group by month
 const byMonth={};
 categoryRecords.forEach(r=>{
  const monthPrefix=r.date.slice(0,7);
  if(!byMonth[monthPrefix]) byMonth[monthPrefix]=[];
  byMonth[monthPrefix].push(r);
 });

 const cat=Object.values(CATEGORIES).find(c=>c.name===categoryName)||CATEGORIES.uncategorized;
 let html=`<h4>${cat.emoji} ${categoryName} - ${year}</h4>`;

 // Sort months chronologically
 Object.keys(byMonth).sort().forEach(monthPrefix=>{
  const parts=monthPrefix.split('-');
  const monthNum=parseInt(parts[1])-1;
  const monthDisplay=getMonthName(monthNum);
  const monthRecords=byMonth[monthPrefix];
  const monthTotal=monthRecords.reduce((sum,r)=>sum+r.amount,0);

  html+=`<div style="margin-top:16px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.1);">
   <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
    <span style="font-size:13px;color:var(--muted);">${monthDisplay}</span>
    <span style="font-size:13px;font-weight:600;color:var(--accent);">${formatAmount(monthTotal)}</span>
   </div>`;

  monthRecords.forEach(r=>{
   html+=`
    <div class="record">
     <div class="icon">${cat.emoji}</div>
     <div class="recMain">
      <div class="recTitle">${r.item}</div>
      <div class="recMeta">${formatDateDisplay(r.date.slice(0,10))}</div>
     </div>
     <div class="recRight">
      <div class="amount">${formatAmount(r.amount)}</div>
      <button class="menuBtn" data-id="${r.id}">‚ãÆ</button>
     </div>
    </div>`;
  });

  html+='</div>';
 });

 container.innerHTML=html;

 container.querySelectorAll('.menuBtn').forEach(btn=>{
  btn.onclick=()=>{
   currentRecordId=btn.dataset.id;
   actionOverlay.classList.add('show');
  };
 });
}

function showMonthSummary(monthPrefix){
 const monthRecords=records.filter(r=>r.date.slice(0,10).startsWith(monthPrefix));
 const container=document.getElementById('expenseList');

 const parts=monthPrefix.split('-');
 const year=parseInt(parts[0]);
 const month=parseInt(parts[1])-1;
 const monthYearDisplay=`${getMonthName(month)} ${year}`;

 if(monthRecords.length===0){
  container.innerHTML=`<h4>${monthYearDisplay}</h4><p style="color:var(--muted);margin-top:8px;">No expenses this month</p>`;
  return;
 }

 const totalExpenses=monthRecords.reduce((sum,r)=>sum+r.amount,0);
 const daysInMonth=new Date(year,month+1,0).getDate();
 const avgPerDay=totalExpenses/daysInMonth;

 let html=`
  <h4>${monthYearDisplay}</h4>
  <div class="row" style="margin-top:16px;">
   <div class="card">
    <div class="label">Total</div>
    <div class="value">${formatAmount(totalExpenses)}</div>
   </div>
   <div class="card">
    <div class="label">Avg/Day</div>
    <div class="value">${formatAmount(avgPerDay)}</div>
   </div>
  </div>`;

 container.innerHTML=html;
}

function showExpensesForMonth(monthPrefix){
 const monthRecords=records.filter(r=>r.date.slice(0,10).startsWith(monthPrefix));
 const container=document.getElementById('expenseList');

 if(monthRecords.length===0){
  container.innerHTML='<h4>No expenses in this month</h4>';
  return;
 }

 const dailyTotals={};
 monthRecords.forEach(r=>{
  const recDate=r.date.slice(0,10);
  dailyTotals[recDate]=(dailyTotals[recDate]||0)+r.amount;
 });

 let html=`<h4>Expenses for ${monthPrefix}</h4>`;
 Object.keys(dailyTotals).sort().forEach(date=>{
  const dayRecords=records.filter(r=>r.date.slice(0,10)===date);
  html+=`<div class="card" style="margin-bottom:8px;"><div class="label">${date}</div><div class="value">${formatAmount(dailyTotals[date])}</div></div>`;
  dayRecords.forEach(r=>{
   html+=`
    <div class="record">
     <div class="icon">${ICONS[r.category]||'‚ùì'}</div>
     <div class="recMain">
      <div class="recTitle">${r.item}</div>
      <div class="recMeta">${r.category}</div>
     </div>
     <div class="recRight">
      <div class="amount">${formatAmount(r.amount)}</div>
      <button class="menuBtn" data-id="${r.id}">‚ãÆ</button>
     </div>
    </div>`;
  });
 });

 container.innerHTML=html;

 container.querySelectorAll('.menuBtn').forEach(btn=>{
  btn.onclick=()=>{
   currentRecordId=btn.dataset.id;
   actionOverlay.classList.add('show');
  };
 });
}

// make analytics buttons clickable
document.getElementById('todayBtn').onclick=()=>{
 if(currentChartType){
  closeChart();
 }
};
document.getElementById('monthBtn').onclick=()=>openChart('month');
document.getElementById('yearBtn').onclick=()=>openChart('year');

// Daily view toggle buttons
document.querySelectorAll('.viewToggleBtn').forEach(btn=>{
 btn.addEventListener('click',()=>{
  document.querySelectorAll('.viewToggleBtn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentDailyView=btn.getAttribute('data-view');
  render();
 });
});

// currency selector
const currencySelector=document.getElementById('currencySelector');
const currencySearch=document.getElementById('currencySearch');
const currencyList=document.getElementById('currencyList');
const currencyBtn=document.getElementById('currencyBtn');
const selectedCurrencyDisplay=document.getElementById('selectedCurrency');

function openCurrencySelector(){
 currencySelector.classList.add('show');
 currencySearch.value='';
 renderCurrencyList('');
 setTimeout(()=>currencySearch.focus(),100);
}

function closeCurrencySelector(){
 currencySelector.classList.remove('show');
}

function renderCurrencyList(filter){
 const filterLower=filter.toLowerCase();
 const filtered=CURRENCIES.filter(c=>
  c.code.toLowerCase().includes(filterLower)||
  c.name.toLowerCase().includes(filterLower)
 );

 currencyList.innerHTML='';
 filtered.forEach(curr=>{
  const btn=document.createElement('button');
  btn.className='currencyItem'+(curr.code===currentCurrency?' selected':'');
  btn.innerHTML=`<span class="currencyCode">${curr.code}</span><span class="currencyName">${curr.name}</span>`;
  btn.onclick=()=>selectCurrency(curr.code);
  currencyList.appendChild(btn);
 });
}

function selectCurrency(code){
 currentCurrency=code;
 localStorage.setItem('currency',code);
 selectedCurrencyDisplay.textContent=getCurrencyDisplay();
 closeCurrencySelector();
 render();
 if(currentChartType){
  if(currentChartType==='month') showMonthChart();
  else if(currentChartType==='year') showYearChart();
 }
}

currencyBtn.onclick=openCurrencySelector;
currencySelector.onclick=(e)=>{
 if(e.target===currencySelector) closeCurrencySelector();
};
currencySearch.oninput=(e)=>{
 renderCurrencyList(e.target.value);
};

// initialize currency display
selectedCurrencyDisplay.textContent=getCurrencyDisplay();

// translations
const translations={
 en:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Daily Expenses',
  monthBtn:'Monthly Analytics',
  yearBtn:'Yearly Analytics',
  labelToday:'Today',
  labelMonth:'Month',
  labelYear:'Year',
  recBtn:'üé§ Start recording',
  recBtnActive:'‚è∫ Recording‚Ä¶',
  editBtn:'‚úèÔ∏è Edit',
  deleteBtn:'üóëÔ∏è Delete',
  editTitle:'Edit Expense',
  editItemName:'Name',
  editCategory:'Category',
  editAmount:'Amount',
  editDate:'Date & Time',
  btnCancel:'Cancel',
  btnSave:'Save',
  settingsTitle:'Settings',
  langLabel:'Language',
  currencyLabel:'Currency',
  currencySelectorTitle:'Select Currency',
  currencySearchPlaceholder:'Search currency...'
 },
 ru:{
  appTitle:'üéô Voice Cash',
  todayBtn:'–¢—Ä–∞—Ç—ã –∑–∞ –¥–µ–Ω—å',
  monthBtn:'–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–µ—Å—è—Ü',
  yearBtn:'–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ–¥',
  labelToday:'–°–µ–≥–æ–¥–Ω—è',
  labelMonth:'–ú–µ—Å—è—Ü',
  labelYear:'–ì–æ–¥',
  recBtn:'üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å',
  recBtnActive:'‚è∫ –ó–∞–ø–∏—Å—å‚Ä¶',
  editBtn:'‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
  deleteBtn:'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å',
  editTitle:'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥',
  editItemName:'–ù–∞–∑–≤–∞–Ω–∏–µ',
  editCategory:'–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
  editAmount:'–°—É–º–º–∞',
  editDate:'–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è',
  btnCancel:'–û—Ç–º–µ–Ω–∞',
  btnSave:'–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
  settingsTitle:'–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
  langLabel:'–Ø–∑—ã–∫',
  currencyLabel:'–í–∞–ª—é—Ç–∞',
  currencySelectorTitle:'–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É',
  currencySearchPlaceholder:'–ü–æ–∏—Å–∫ –≤–∞–ª—é—Ç—ã...'
 },
 es:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Gastos diarios',
  monthBtn:'An√°lisis mensual',
  yearBtn:'An√°lisis anual',
  labelToday:'Hoy',
  labelMonth:'Mes',
  labelYear:'A√±o',
  recBtn:'üé§ Iniciar grabaci√≥n',
  recBtnActive:'‚è∫ Grabando‚Ä¶',
  editBtn:'‚úèÔ∏è Editar',
  deleteBtn:'üóëÔ∏è Eliminar',
  editTitle:'Editar gasto',
  editItemName:'Nombre',
  editCategory:'Categor√≠a',
  editAmount:'Cantidad',
  editDate:'Fecha y hora',
  btnCancel:'Cancelar',
  btnSave:'Guardar',
  settingsTitle:'Configuraci√≥n',
  langLabel:'Idioma',
  currencyLabel:'Moneda',
  currencySelectorTitle:'Seleccionar moneda',
  currencySearchPlaceholder:'Buscar moneda...'
 },
 fr:{
  appTitle:'üéô Voice Cash',
  todayBtn:'D√©penses quotidiennes',
  monthBtn:'Analyse mensuelle',
  yearBtn:'Analyse annuelle',
  labelToday:'Aujourd\'hui',
  labelMonth:'Mois',
  labelYear:'Ann√©e',
  recBtn:'üé§ D√©marrer l\'enregistrement',
  recBtnActive:'‚è∫ Enregistrement‚Ä¶',
  editBtn:'‚úèÔ∏è Modifier',
  deleteBtn:'üóëÔ∏è Supprimer',
  editTitle:'Modifier la d√©pense',
  editItemName:'Nom',
  editCategory:'Cat√©gorie',
  editAmount:'Montant',
  editDate:'Date et heure',
  btnCancel:'Annuler',
  btnSave:'Enregistrer',
  settingsTitle:'Param√®tres',
  langLabel:'Langue',
  currencyLabel:'Devise',
  currencySelectorTitle:'S√©lectionner la devise',
  currencySearchPlaceholder:'Rechercher une devise...'
 },
 de:{
  appTitle:'üéô Voice Cash',
  todayBtn:'T√§gliche Ausgaben',
  monthBtn:'Monatsanalyse',
  yearBtn:'Jahresanalyse',
  labelToday:'Heute',
  labelMonth:'Monat',
  labelYear:'Jahr',
  recBtn:'üé§ Aufnahme starten',
  recBtnActive:'‚è∫ Aufnahme l√§uft‚Ä¶',
  editBtn:'‚úèÔ∏è Bearbeiten',
  deleteBtn:'üóëÔ∏è L√∂schen',
  editTitle:'Ausgabe bearbeiten',
  editItemName:'Name',
  editCategory:'Kategorie',
  editAmount:'Betrag',
  editDate:'Datum und Uhrzeit',
  btnCancel:'Abbrechen',
  btnSave:'Speichern',
  settingsTitle:'Einstellungen',
  langLabel:'Sprache',
  currencyLabel:'W√§hrung',
  currencySelectorTitle:'W√§hrung ausw√§hlen',
  currencySearchPlaceholder:'W√§hrung suchen...'
 },
 it:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Spese giornaliere',
  monthBtn:'Analisi mensile',
  yearBtn:'Analisi annuale',
  labelToday:'Oggi',
  labelMonth:'Mese',
  labelYear:'Anno',
  recBtn:'üé§ Avvia registrazione',
  recBtnActive:'‚è∫ Registrazione‚Ä¶',
  editBtn:'‚úèÔ∏è Modifica',
  deleteBtn:'üóëÔ∏è Elimina',
  editTitle:'Modifica spesa',
  editItemName:'Nome',
  editCategory:'Categoria',
  editAmount:'Importo',
  editDate:'Data e ora',
  btnCancel:'Annulla',
  btnSave:'Salva',
  settingsTitle:'Impostazioni',
  langLabel:'Lingua',
  currencyLabel:'Valuta',
  currencySelectorTitle:'Seleziona valuta',
  currencySearchPlaceholder:'Cerca valuta...'
 },
 pt:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Despesas di√°rias',
  monthBtn:'An√°lise mensal',
  yearBtn:'An√°lise anual',
  labelToday:'Hoje',
  labelMonth:'M√™s',
  labelYear:'Ano',
  recBtn:'üé§ Iniciar grava√ß√£o',
  recBtnActive:'‚è∫ Gravando‚Ä¶',
  editBtn:'‚úèÔ∏è Editar',
  deleteBtn:'üóëÔ∏è Excluir',
  editTitle:'Editar despesa',
  editItemName:'Nome',
  editCategory:'Categoria',
  editAmount:'Valor',
  editDate:'Data e hora',
  btnCancel:'Cancelar',
  btnSave:'Salvar',
  settingsTitle:'Configura√ß√µes',
  langLabel:'Idioma',
  currencyLabel:'Moeda',
  currencySelectorTitle:'Selecionar moeda',
  currencySearchPlaceholder:'Pesquisar moeda...'
 },
 zh:{
  appTitle:'üéô Voice Cash',
  todayBtn:'ÊØèÊó•ÊîØÂá∫',
  monthBtn:'ÊúàÂ∫¶ÂàÜÊûê',
  yearBtn:'Âπ¥Â∫¶ÂàÜÊûê',
  labelToday:'‰ªäÂ§©',
  labelMonth:'Êúà',
  labelYear:'Âπ¥',
  recBtn:'üé§ ÂºÄÂßãÂΩïÈü≥',
  recBtnActive:'‚è∫ ÂΩïÈü≥‰∏≠‚Ä¶',
  editBtn:'‚úèÔ∏è ÁºñËæë',
  deleteBtn:'üóëÔ∏è Âà†Èô§',
  editTitle:'ÁºñËæëÊîØÂá∫',
  editItemName:'ÂêçÁß∞',
  editCategory:'Á±ªÂà´',
  editAmount:'ÈáëÈ¢ù',
  editDate:'Êó•ÊúüÂíåÊó∂Èó¥',
  btnCancel:'ÂèñÊ∂à',
  btnSave:'‰øùÂ≠ò',
  settingsTitle:'ËÆæÁΩÆ',
  langLabel:'ËØ≠Ë®Ä',
  currencyLabel:'Ë¥ßÂ∏Å',
  currencySelectorTitle:'ÈÄâÊã©Ë¥ßÂ∏Å',
  currencySearchPlaceholder:'ÊêúÁ¥¢Ë¥ßÂ∏Å...'
 },
 ja:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Êó•Ê¨°ÊîØÂá∫',
  monthBtn:'ÊúàÊ¨°ÂàÜÊûê',
  yearBtn:'Âπ¥Ê¨°ÂàÜÊûê',
  labelToday:'‰ªäÊó•',
  labelMonth:'Êúà',
  labelYear:'Âπ¥',
  recBtn:'üé§ Èå≤Èü≥ÈñãÂßã',
  recBtnActive:'‚è∫ Èå≤Èü≥‰∏≠‚Ä¶',
  editBtn:'‚úèÔ∏è Á∑®ÈõÜ',
  deleteBtn:'üóëÔ∏è ÂâäÈô§',
  editTitle:'ÊîØÂá∫„ÇíÁ∑®ÈõÜ',
  editItemName:'ÂêçÂâç',
  editCategory:'„Ç´„ÉÜ„Ç¥„É™„Éº',
  editAmount:'ÈáëÈ°ç',
  editDate:'Êó•ÊôÇ',
  btnCancel:'„Ç≠„É£„É≥„Çª„É´',
  btnSave:'‰øùÂ≠ò',
  settingsTitle:'Ë®≠ÂÆö',
  langLabel:'Ë®ÄË™û',
  currencyLabel:'ÈÄöË≤®',
  currencySelectorTitle:'ÈÄöË≤®„ÇíÈÅ∏Êäû',
  currencySearchPlaceholder:'ÈÄöË≤®„ÇíÊ§úÁ¥¢...'
 },
 ko:{
  appTitle:'üéô Voice Cash',
  todayBtn:'ÏùºÏùº ÏßÄÏ∂ú',
  monthBtn:'ÏõîÍ∞Ñ Î∂ÑÏÑù',
  yearBtn:'Ïó∞Í∞Ñ Î∂ÑÏÑù',
  labelToday:'Ïò§Îäò',
  labelMonth:'Ïõî',
  labelYear:'ÎÖÑ',
  recBtn:'üé§ ÎÖπÏùå ÏãúÏûë',
  recBtnActive:'‚è∫ ÎÖπÏùå Ï§ë‚Ä¶',
  editBtn:'‚úèÔ∏è Ìé∏Ïßë',
  deleteBtn:'üóëÔ∏è ÏÇ≠Ï†ú',
  editTitle:'ÏßÄÏ∂ú Ìé∏Ïßë',
  editItemName:'Ïù¥Î¶Ñ',
  editCategory:'Ïπ¥ÌÖåÍ≥†Î¶¨',
  editAmount:'Í∏àÏï°',
  editDate:'ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ',
  btnCancel:'Ï∑®ÏÜå',
  btnSave:'Ï†ÄÏû•',
  settingsTitle:'ÏÑ§Ï†ï',
  langLabel:'Ïñ∏Ïñ¥',
  currencyLabel:'ÌÜµÌôî',
  currencySelectorTitle:'ÌÜµÌôî ÏÑ†ÌÉù',
  currencySearchPlaceholder:'ÌÜµÌôî Í≤ÄÏÉâ...'
 },
 ar:{
  appTitle:'üéô Voice Cash',
  todayBtn:'ÿßŸÑŸÜŸÅŸÇÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©',
  monthBtn:'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ¥Ÿáÿ±Ÿä',
  yearBtn:'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ŸÜŸàŸä',
  labelToday:'ÿßŸÑŸäŸàŸÖ',
  labelMonth:'ÿßŸÑÿ¥Ÿáÿ±',
  labelYear:'ÿßŸÑÿ≥ŸÜÿ©',
  recBtn:'üé§ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ',
  recBtnActive:'‚è∫ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ‚Ä¶',
  editBtn:'‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ',
  deleteBtn:'üóëÔ∏è ÿ≠ÿ∞ŸÅ',
  editTitle:'ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÜŸÅŸÇÿßÿ™',
  editItemName:'ÿßŸÑÿßÿ≥ŸÖ',
  editCategory:'ÿßŸÑŸÅÿ¶ÿ©',
  editAmount:'ÿßŸÑŸÖÿ®ŸÑÿ∫',
  editDate:'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™',
  btnCancel:'ÿ•ŸÑÿ∫ÿßÿ°',
  btnSave:'ÿ≠ŸÅÿ∏',
  settingsTitle:'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
  langLabel:'ÿßŸÑŸÑÿ∫ÿ©',
  currencyLabel:'ÿßŸÑÿπŸÖŸÑÿ©',
  currencySelectorTitle:'ÿßÿÆÿ™ÿ± ÿßŸÑÿπŸÖŸÑÿ©',
  currencySearchPlaceholder:'ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿπŸÖŸÑÿ©...'
 },
 hi:{
  appTitle:'üéô Voice Cash',
  todayBtn:'‡§¶‡•à‡§®‡§ø‡§ï ‡§ñ‡§∞‡•ç‡§ö',
  monthBtn:'‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£',
  yearBtn:'‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£',
  labelToday:'‡§Ü‡§ú',
  labelMonth:'‡§Æ‡§π‡•Ä‡§®‡§æ',
  labelYear:'‡§µ‡§∞‡•ç‡§∑',
  recBtn:'üé§ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
  recBtnActive:'‚è∫ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶',
  editBtn:'‚úèÔ∏è ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
  deleteBtn:'üóëÔ∏è ‡§π‡§ü‡§æ‡§è‡§Ç',
  editTitle:'‡§ñ‡§∞‡•ç‡§ö ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
  editItemName:'‡§®‡§æ‡§Æ',
  editCategory:'‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
  editAmount:'‡§∞‡§æ‡§∂‡§ø',
  editDate:'‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§î‡§∞ ‡§∏‡§Æ‡§Ø',
  btnCancel:'‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
  btnSave:'‡§∏‡§π‡•á‡§ú‡•á‡§Ç',
  settingsTitle:'‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
  langLabel:'‡§≠‡§æ‡§∑‡§æ',
  currencyLabel:'‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ',
  currencySelectorTitle:'‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
  currencySearchPlaceholder:'‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ ‡§ñ‡•ã‡§ú‡•á‡§Ç...'
 },
 tr:{
  appTitle:'üéô Voice Cash',
  todayBtn:'G√ºnl√ºk Harcamalar',
  monthBtn:'Aylƒ±k Analiz',
  yearBtn:'Yƒ±llƒ±k Analiz',
  labelToday:'Bug√ºn',
  labelMonth:'Ay',
  labelYear:'Yƒ±l',
  recBtn:'üé§ Kaydƒ± ba≈ülat',
  recBtnActive:'‚è∫ Kaydediliyor‚Ä¶',
  editBtn:'‚úèÔ∏è D√ºzenle',
  deleteBtn:'üóëÔ∏è Sil',
  editTitle:'Harcamayƒ± D√ºzenle',
  editItemName:'ƒ∞sim',
  editCategory:'Kategori',
  editAmount:'Tutar',
  editDate:'Tarih ve saat',
  btnCancel:'ƒ∞ptal',
  btnSave:'Kaydet',
  settingsTitle:'Ayarlar',
  langLabel:'Dil',
  currencyLabel:'Para birimi',
  currencySelectorTitle:'Para birimi se√ßin',
  currencySearchPlaceholder:'Para birimi ara...'
 },
 nl:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Dagelijkse uitgaven',
  monthBtn:'Maandanalyse',
  yearBtn:'Jaaranalyse',
  labelToday:'Vandaag',
  labelMonth:'Maand',
  labelYear:'Jaar',
  recBtn:'üé§ Start opname',
  recBtnActive:'‚è∫ Opnemen‚Ä¶',
  editBtn:'‚úèÔ∏è Bewerken',
  deleteBtn:'üóëÔ∏è Verwijderen',
  editTitle:'Uitgave bewerken',
  editItemName:'Naam',
  editCategory:'Categorie',
  editAmount:'Bedrag',
  editDate:'Datum en tijd',
  btnCancel:'Annuleren',
  btnSave:'Opslaan',
  settingsTitle:'Instellingen',
  langLabel:'Taal',
  currencyLabel:'Valuta',
  currencySelectorTitle:'Selecteer valuta',
  currencySearchPlaceholder:'Zoek valuta...'
 },
 pl:{
  appTitle:'üéô Voice Cash',
  todayBtn:'Wydatki dzienne',
  monthBtn:'Analiza miesiƒôczna',
  yearBtn:'Analiza roczna',
  labelToday:'Dzisiaj',
  labelMonth:'MiesiƒÖc',
  labelYear:'Rok',
  recBtn:'üé§ Rozpocznij nagrywanie',
  recBtnActive:'‚è∫ Nagrywanie‚Ä¶',
  editBtn:'‚úèÔ∏è Edytuj',
  deleteBtn:'üóëÔ∏è Usu≈Ñ',
  editTitle:'Edytuj wydatek',
  editItemName:'Nazwa',
  editCategory:'Kategoria',
  editAmount:'Kwota',
  editDate:'Data i godzina',
  btnCancel:'Anuluj',
  btnSave:'Zapisz',
  settingsTitle:'Ustawienia',
  langLabel:'Jƒôzyk',
  currencyLabel:'Waluta',
  currencySelectorTitle:'Wybierz walutƒô',
  currencySearchPlaceholder:'Szukaj waluty...'
 }
};

let currentLang=localStorage.getItem('lang')||'ru';

function applyTranslations(){
 const t=translations[currentLang]||translations.en;
 document.getElementById('appTitle').textContent=t.appTitle;
 document.getElementById('todayBtn').textContent=t.todayBtn;
 document.getElementById('monthBtn').textContent=t.monthBtn;
 document.getElementById('yearBtn').textContent=t.yearBtn;
 document.getElementById('labelToday').textContent=t.labelToday;
 document.getElementById('labelMonth').textContent=t.labelMonth;
 document.getElementById('labelYear').textContent=t.labelYear;
 if(!isRec) document.getElementById('recBtn').textContent=t.recBtn;
 document.getElementById('editBtn').textContent=t.editBtn;
 document.getElementById('deleteBtn').textContent=t.deleteBtn;
 document.querySelectorAll('.editForm h2')[0].textContent=t.editTitle;
 document.getElementById('labelEditName').textContent=t.editItemName;
 document.getElementById('labelEditCategory').textContent=t.editCategory;
 document.getElementById('labelEditAmount').textContent=t.editAmount;
 document.getElementById('labelEditDate').textContent=t.editDate;
 document.getElementById('cancelEdit').textContent=t.btnCancel;
 document.getElementById('saveEdit').textContent=t.btnSave;
 document.getElementById('settingsTitle').textContent=t.settingsTitle;
 document.getElementById('langLabel').textContent=t.langLabel;
 document.getElementById('langSelect').value=currentLang;
 document.getElementById('currencyLabel').textContent=t.currencyLabel;
 document.getElementById('currencySelectorTitle').textContent=t.currencySelectorTitle;
 document.getElementById('currencySearch').placeholder=t.currencySearchPlaceholder;
}

// navigation
document.getElementById('settingsBtn').onclick=()=>{
 document.getElementById('mainPage').classList.remove('active');
 document.getElementById('settingsPage').classList.add('active');
};

document.getElementById('backBtn').onclick=()=>{
 document.getElementById('settingsPage').classList.remove('active');
 document.getElementById('mainPage').classList.add('active');
};

document.getElementById('langSelect').onchange=(e)=>{
 currentLang=e.target.value;
 localStorage.setItem('lang',currentLang);
 applyTranslations();
};

applyTranslations();
render();

// Page Visibility API - pause animations when app is hidden
document.addEventListener('visibilitychange',()=>{
 if(document.hidden){
  document.body.classList.add('paused');
 }else{
  document.body.classList.remove('paused');
 }
});
</script>
</body>
</html>
