<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Cash</title>

<style>
:root{
--bg:#0f0f14;--card:#1a1a26;--accent:#7c5cff;
--danger:#ff4d4d;--text:#fff;--muted:#9a9ab3
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.app{max-width:480px;margin:auto;padding:20px}
h1{text-align:center;margin:6px 0}

.cards{display:flex;gap:10px;margin-bottom:12px}
.card{flex:1;background:var(--card);padding:12px;border-radius:14px;text-align:center}
.label{color:var(--muted)}
.value{color:var(--accent);font-size:20px}

button{
width:100%;padding:16px;font-size:18px;
border-radius:16px;border:none;
background:var(--accent);color:#fff;margin-bottom:8px
}
button.recording{background:var(--danger);animation:pulse 1.2s infinite}
@keyframes pulse{
0%{box-shadow:0 0 0 0 rgba(255,77,77,.6)}
70%{box-shadow:0 0 0 18px rgba(255,77,77,0)}
}

.status{text-align:center;color:var(--muted);margin-bottom:10px}
.hidden{display:none}

/* === ARCHIVE === */
.day{margin-top:14px}
.day-header{display:flex;justify-content:space-between;color:var(--accent)}
.record{background:var(--card);padding:10px;border-radius:10px;display:flex;justify-content:space-between;margin-top:6px}
.time{font-size:12px;color:var(--muted)}

/* === ANALYTICS === */
.chart{
display:flex;align-items:flex-end;
gap:6px;height:160px;
margin-top:20px;overflow-x:auto;padding-bottom:10px
}
.bar{
flex:0 0 20px;
background:var(--accent);
border-radius:6px;
position:relative;
opacity:.85
}
.bar-label{
position:absolute;bottom:-18px;
font-size:10px;color:var(--muted);
transform:rotate(-45deg);transform-origin:left
}
.bar-value{
position:absolute;top:-18px;
font-size:11px;color:#fff
}
.bar.active{background:#fff}

</style>
</head>

<body>
<div class="app">

<h1>üéô Voice Cash</h1>

<div class="cards">
<div class="card"><div class="label">–°–µ–≥–æ–¥–Ω—è</div><div class="value" id="todaySum">0</div></div>
<div class="card"><div class="label">–ú–µ—Å—è—Ü</div><div class="value" id="monthSum">0</div></div>
</div>

<button id="recBtn">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
<button onclick="toggleAnalytics()">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>

<div class="status" id="status"></div>

<div id="archive"></div>
<div id="analytics" class="hidden"></div>

</div>

<script>
let records=JSON.parse(localStorage.getItem('vc-records'))||[];
let recognition=null,isRecording=false,analyticsOpen=false;
const $=id=>document.getElementById(id);
const today=()=>new Date().toISOString().slice(0,10);
const time=()=>new Date().toTimeString().slice(0,5);
const month=()=>today().slice(0,7);

/* ===== RENDER MAIN ===== */
function render(){
$('archive').innerHTML='';
let t=0,m=0,byDay={};

records.forEach(r=>{
if(r.date===today())t+=r.amount;
if(r.date.startsWith(month()))m+=r.amount;
(byDay[r.date]=byDay[r.date]||[]).push(r);
});

$('todaySum').textContent=t;
$('monthSum').textContent=m;

Object.keys(byDay).sort().reverse().forEach(d=>{
const sum=byDay[d].reduce((s,r)=>s+r.amount,0);
let day=document.createElement('div');
day.className='day';
day.innerHTML=`<div class="day-header"><span>${d}</span><span>${sum}</span></div>`;
byDay[d].forEach(r=>{
day.innerHTML+=`
<div class="record">
<div>${r.item}<div class="time">${r.time}</div></div>
<div>${r.amount}</div>
</div>`;
});
$('archive').appendChild(day);
});
}

/* ===== ANALYTICS ===== */
function renderAnalytics(){
$('analytics').innerHTML='';
let byDay={},max=0;

records.forEach(r=>{
byDay[r.date]=(byDay[r.date]||0)+r.amount;
max=Math.max(max,byDay[r.date]);
});

let chart=document.createElement('div');
chart.className='chart';

Object.keys(byDay).sort().forEach(d=>{
let h=Math.round((byDay[d]/max)*140)+10;
let bar=document.createElement('div');
bar.className='bar';
bar.style.height=h+'px';
bar.innerHTML=`
<div class="bar-value">${byDay[d]}</div>
<div class="bar-label">${d.slice(5)}</div>`;
bar.onclick=()=>showDay(d);
chart.appendChild(bar);
});

$('analytics').appendChild(chart);
}

function showDay(date){
$('analytics').innerHTML=`<h3>–¢—Ä–∞—Ç—ã –∑–∞ ${date}</h3>`;
records.filter(r=>r.date===date).forEach(r=>{
$('analytics').innerHTML+=`
<div class="record">
<div>${r.item}<div class="time">${r.time}</div></div>
<div>${r.amount}</div>
</div>`;
});
}

/* ===== TOGGLE ===== */
function toggleAnalytics(){
analyticsOpen=!analyticsOpen;
$('analytics').classList.toggle('hidden',!analyticsOpen);
$('archive').classList.toggle('hidden',analyticsOpen);
if(analyticsOpen)renderAnalytics();
}

/* ===== VOICE ===== */
$('recBtn').onclick=()=>isRecording?stop():start();
function start(){
if(!('webkitSpeechRecognition'in window))return alert('No voice');
recognition=new webkitSpeechRecognition();
recognition.lang='ru-RU';recognition.start();
isRecording=true;
$('recBtn').classList.add('recording');
$('recBtn').textContent='‚èπ –°—Ç–æ–ø';
$('status').textContent='–ì–æ–≤–æ—Ä–∏: "–∫–æ—Ñ–µ 200"';
recognition.onresult=e=>parse(e.results[0][0].transcript.toLowerCase());
recognition.onend=stop;
}
function stop(){
if(recognition)recognition.stop();
isRecording=false;
$('recBtn').classList.remove('recording');
$('recBtn').textContent='üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';
}

/* ===== PARSE ===== */
function parse(t){
$('status').textContent=`"${t}"`;
let m=t.match(/^(.*)\s(\d+)$/);
if(!m)return;
records.unshift({
item:m[1].trim(),
amount:+m[2],
date:today(),
time:time()
});
localStorage.setItem('vc-records',JSON.stringify(records));
render();
}

render();
</script>
</body>
</html>
